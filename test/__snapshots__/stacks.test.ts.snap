// Jest Snapshot v1, https://jestjs.io/docs/snapshot-testing

exports[`OpenHands Infrastructure Stacks AuthStack matches snapshot 1`] = `
{
  "Outputs": {
    "ClientSecretName": {
      "Value": "openhands/cognito-client-secret-shared",
    },
    "UserPoolClientId": {
      "Value": {
        "Ref": "UserPoolWebAppClientCD2D5CB1",
      },
    },
    "UserPoolDomainPrefix": {
      "Value": {
        "Ref": "UserPoolCognitoDomainD6C7F9FA",
      },
    },
    "UserPoolId": {
      "Value": {
        "Ref": "UserPool6BA7E5F2",
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AWS679f53fac002430cb0da5b7982bd22872D164C4C": {
      "DependsOn": [
        "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-123456789012-us-east-1",
          "S3Key": "bc8ef58951f4c88e641dd23090e9d2e2e61c7530a07960e767522941e959b625.zip",
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 120,
      },
      "Type": "AWS::Lambda::Function",
    },
    "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CognitoClientSecret800946F9": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "Description": "Cognito User Pool Client Secret for OpenHands",
        "Name": "openhands/cognito-client-secret-shared",
        "SecretString": {
          "Fn::GetAtt": [
            "UserPoolWebAppClientDescribeCognitoUserPoolClient2F6BCD92",
            "UserPoolClient.ClientSecret",
          ],
        },
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "ManagedLoginBranding": {
      "DependsOn": [
        "UserPoolCognitoDomainD6C7F9FA",
      ],
      "Properties": {
        "Assets": [
          {
            "Bytes": "PHN2ZyB3aWR0aD0iMTM2NSIgaGVpZ2h0PSIxMzY1IiB2aWV3Qm94PSIwIC0yNCAxNDggMTQ4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNNzEuNzU0MiAxNi44NjNWMi45NzQxNEM3MS43NTQyIDEuODIzNTUgNzIuNjg3MiAwLjg5MDUwMyA3My44Mzc4IDAuODkwNTAzQzc0Ljk4ODQgMC44OTA1MDMgNzUuOTIxNCAxLjgyMzU1IDc1LjkyMTQgMi45NzQxNFYxNi44NjNDNzUuOTIxNCAxOC4wMTM2IDc0Ljk4ODQgMTguOTQ2NiA3My44Mzc4IDE4Ljk0NjZDNzIuNjg3MiAxOC45NDY2IDcxLjc1NDIgMTguMDEzNiA3MS43NTQyIDE2Ljg2M1oiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik04Mi41MjcyIDE4LjkzMjlMODkuNDcxNiA2LjkwNDc3QzkwLjA0NjkgNS45MDgzMiA5MS4zMjE1IDUuNTY2OCA5Mi4zMTc5IDYuMTQyMUM5My4zMTQ0IDYuNzE3NCA5My42NTU5IDcuOTkxOTcgOTMuMDgwNiA4Ljk4ODQxTDg2LjEzNjIgMjEuMDE2NUM4NS41NjA5IDIyLjAxMjkgODQuMjg2MyAyMi4zNTQ1IDgzLjI4OTkgMjEuNzc5MkM4Mi4yOTM0IDIxLjIwMzkgODEuOTUxOSAxOS45MjkzIDgyLjUyNzIgMTguOTMyOVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik02NS4xNDgxIDE4LjkzMjlMNTguMjAzNyA2LjkwNDc3QzU3LjYyODQgNS45MDgzMiA1Ni4zNTM4IDUuNTY2OCA1NS4zNTc0IDYuMTQyMUM1NC4zNjA5IDYuNzE3NCA1NC4wMTk0IDcuOTkxOTcgNTQuNTk0NyA4Ljk4ODQxTDYxLjUzOTEgMjEuMDE2NUM2Mi4xMTQ0IDIyLjAxMjkgNjMuMzg5IDIyLjM1NDUgNjQuMzg1NCAyMS43NzkyQzY1LjM4MTkgMjEuMjAzOSA2NS43MjM0IDE5LjkyOTMgNjUuMTQ4MSAxOC45MzI5WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE0MC42MDYgNjIuMDI5MkMxNDAuNjA2IDU4LjQwOSAxNDEuNTgzIDQ3LjY3NDggMTQxLjg5IDQ0LjEzMjNDMTQyLjA5NyA0MS43Mzc0IDE0MS44MDkgNDAuNDI0NyAxNDEuNDI0IDM5Ljc1NDJDMTQxLjE0MSAzOS4yNjI2IDE0MC42OTkgMzguOTE1IDEzOS42MzQgMzguODQzNkMxMzguODY1IDM4Ljc5MjEgMTM4LjAyNyAzOS4wMTE0IDEzNy40MDEgMzkuNTc2MUMxMzYuODE0IDQwLjEwNTIgMTM2LjE1OSA0MS4xNjgyIDEzNi4xNTkgNDMuMzE3NkwxMzYuMTU1IDQzLjQzODhMMTM1LjE5OCA1OS43NThDMTM1LjE2NCA2MC4zNDUxIDEzNC44ODMgNjAuODkxMSAxMzQuNDI0IDYxLjI1OTlDMTMzLjk2NiA2MS42Mjg0IDEzMy4zNzQgNjEuNzg1OSAxMzIuNzkzIDYxLjY5NDFMMTIyLjc2NCA2MC4xMDY4TDExMS45NDggNTguNjcwM0MxMTAuOTQ5IDU4LjUzNzYgMTEwLjE4OCA1Ny43MDg0IDExMC4xNDIgNTYuNzAxNkwxMDkuNTYxIDQ0LjEzMjNDMTA5LjUzNSA0My42MjEgMTA5LjUxIDQzLjExNDEgMTA5LjQ4NCA0Mi42MTQ2QzEwOS4yNDEgMzcuOTI5NCAxMDkuMDIyIDMzLjc4MDUgMTA5LjAyMiAzMi40MjgyQzEwOS4wMjIgMjguMzg1OSAxMDguMzM4IDI2LjY4MDYgMTA3Ljc0IDI1Ljk2MzRDMTA3LjI2MyAyNS4zOTE1IDEwNi41NzcgMjUuMTQwMiAxMDUuMTEgMjUuMTQwMkMxMDQuNTgzIDI1LjE0MDIgMTA0LjIxMiAyNS4yNDgxIDEwMy45MzMgMjUuNDExMUMxMDMuNjU5IDI1LjU3MTQgMTAzLjM0NiAyNS44NTg3IDEwMy4wNDkgMjYuNDIwOEMxMDIuNDEgMjcuNjI1NyAxMDEuOTQ1IDI5Ljg5MSAxMDIuMTE4IDMzLjg0NzlDMTAyLjM0MiAzOC45ODA0IDEwMi42OTIgNDIuODE0NiAxMDMuMDM1IDQ2LjI3MThDMTAzLjM3NyA0OS43MjMxIDEwMy43MTggNTIuODU2MSAxMDMuOTA4IDU2LjQ5NzFDMTA0LjIwNCA2Mi4xOTY2IDEwNC4xNzggNjYuMTI1NiAxMDMuOTQ1IDY4Ljc5MjRDMTAzLjgyOCA3MC4xMjQgMTAzLjY1NiA3MS4xOTk2IDEwMy40MjMgNzIuMDUwMUMxMDMuMjAyIDcyLjg1NTggMTAyLjg3MSA3My42NzU3IDEwMi4yOTYgNzQuMjg4N0MxMDEuNiA3NS4wMzAzIDEwMC42MDggNzUuMzg0NCA5OS41NzcgNzUuMTM2Qzk4Ljc1OTIgNzQuOTM4OSA5OC4xODQ3IDc0LjQyMTUgOTcuODcwNiA3NC4wOTE2Qzk3LjIxNDEgNzMuNDAxNyA5Ni43NTAxIDcyLjUxMDYgOTYuNTY4IDcyLjA1MTJDOTUuNTA5NyA2OS4zODEyIDkyLjIzNTIgNjMuMTgwOCA4Ny44MDIzIDU5LjY4MTFDODYuNTA4OSA1OC42NTk5IDg1LjU2NjYgNTguMzY1MiA4NC45NzM2IDU4LjMyMDRDODQuNDE0OCA1OC4yNzgzIDg0LjAwOTQgNTguNDQzNiA4My42OTA5IDU4LjY5NjdDODMuMzQgNTguOTc1NiA4My4wNzgxIDU5LjM4MTEgODIuOTQ3OSA1OS43NjQzQzgyLjkwMTkgNTkuODk5OSA4Mi44ODIzIDU5Ljk5NjggODIuODc0MSA2MC4wNTg0Qzg0LjA3NTkgNjIuMDg2NSA4OC44NDIxIDY5LjUyMjIgOTEuMDg5NiA3Ny4wNjlDOTIuNzY0OCA4Mi42OTQxIDk2LjgwMzggODguNDI1OSA5OS44MTk0IDkwLjg4MDlDMTAyLjc0IDkzLjI1OCAxMDcuOTg4IDk0LjczMTMgMTEzLjkgOTUuMDIxOEMxMTkuNzU2IDk1LjMwOTUgMTI1Ljc4OCA5NC40MTIxIDEzMC4wMzMgOTIuNTA5MkMxMzguMjMzIDg4LjgzMzQgMTM5LjkwMyA4MC43MzgyIDE0MC42NTEgNzcuMjI5MkMxNDEuMjMyIDc0LjUwNTcgMTQxLjI0MyA3MS41OTg3IDE0MS4wODcgNjguOTAwOUMxNDEuMDEgNjcuNTU1MSAxNDAuODk0IDY2LjI5NjkgMTQwLjc5MyA2NS4xMzczQzE0MC42OTUgNjQuMDEwNSAxNDAuNjA2IDYyLjkyMTUgMTQwLjYwNiA2Mi4wMjkyWk0xMjAuOTg2IDI3LjA5NTNDMTIwLjk4NiAyNS44MzE0IDEyMC42NDggMjQuNzA0OSAxMjAuMDg5IDIzLjk1MTRDMTE5LjU4MyAyMy4yNyAxMTguODQgMjIuNzk4NyAxMTcuNjQ2IDIyLjc5ODRDMTE2LjY2OCAyMi43OTgyIDExNi4wMTEgMjIuOTE4NyAxMTUuNTQ2IDIzLjExNjdDMTE1LjEzIDIzLjI5NDMgMTE0Ljc4MSAyMy41Njk5IDExNC40NjMgMjQuMDgzMUMxMTMuNzMgMjUuMjY3MSAxMTMuMTkyIDI3LjY0NTUgMTEzLjE4OSAzMi4zODRMMTEzLjcyMSA0My45MDg4QzExMy45MSA0Ny41NjYxIDExNC4xMDYgNTEuNDkyMiAxMTQuMjM1IDU0Ljc3MDdMMTIwLjk4NiA1NS42NjY2VjI3LjA5NTNaTTEyNS4xNTMgNTYuMjY1MkwxMzEuMTcyIDU3LjIxOEwxMzEuOTkyIDQzLjI2N1YzMi41MDgzQzEzMS45OTIgMzEuMDMxIDEzMS4zOSAzMC4xMjc1IDEzMC42NzggMjkuNTQ4OUMxMjkuODg0IDI4LjkwMzkgMTI4Ljk1NyAyOC42NzMxIDEyOC41MTkgMjguNjczMUMxMjcuNzIyIDI4LjY3MzEgMTI2Ljg5OSAyOC43OTcgMTI2LjMwNiAyOS4yMTc5QzEyNS44NDkgMjkuNTQyMSAxMjUuMTUzIDMwLjMwODcgMTI1LjE1MyAzMi41MDgzVjU2LjI2NTJaTTEzNi4xNTkgMzUuNDI3OEMxMzcuNDA2IDM0LjgwNjkgMTM4Ljc0IDM0LjYwODMgMTM5LjkxMiAzNC42ODY4QzE0Mi4wMzcgMzQuODI5MiAxNDMuOTEgMzUuNzE4IDE0NS4wMzcgMzcuNjc3OUMxNDYuMDYgMzkuNDU5MiAxNDYuMjczIDQxLjgxMzYgMTQ2LjA0MSA0NC40OTI3QzE0NS43MiA0OC4xOTQ5IDE0NC43NzIgNTguNjQ1NyAxNDQuNzcyIDYyLjAyOTJDMTQ0Ljc3MiA2Mi43MDggMTQ0Ljg0MyA2My42MTE2IDE0NC45NDQgNjQuNzc1OEMxNDUuMDQyIDY1LjkwNyAxNDUuMTY1IDY3LjIzODkgMTQ1LjI0NyA2OC42NjA2QzE0NS40MTEgNzEuNDk4NyAxNDUuNDIyIDc0LjgzODMgMTQ0LjcyNyA3OC4wOTg3QzE0NC4wMDIgODEuNDk1MyAxNDIuMDQxIDkxLjY5MTggMTMxLjczOCA5Ni4zMTA4QzEyNi43MzEgOTguNTU1MSAxMjAuMDAyIDk5LjQ5MzYgMTEzLjY5NiA5OS4xODM4QzEwNy40NDUgOTguODc2NyAxMDEuMTI4IDk3LjMxODkgOTcuMTg4NyA5NC4xMTIyQzkzLjQ4MDkgOTEuMDkzNyA4OC45OTM4IDg0LjYzMDcgODcuMDk2MiA3OC4yNTg5Qzg0Ljk1MjkgNzEuMDYxOSA4MC4zMTA5IDYzLjk2NDYgNzkuMTUyNyA2MS45NTMzQzc4LjQ3MDYgNjAuNzY4OSA3OC42ODQgNTkuMzYyOCA3OS4wMDE5IDU4LjQyNThDNzkuMzYwNyA1Ny4zNjg4IDgwLjA1NTQgNTYuMjYzMSA4MS4wOTkzIDU1LjQzMzdDODIuMTc1OCA1NC41Nzg0IDgzLjYwNDMgNTQuMDM3NyA4NS4yODc2IDU0LjE2NDdDODYuOTM2OSA1NC4yODkzIDg4LjY0NjIgNTUuMDM5MyA5MC4zODM0IDU2LjQxMDdDOTQuODU0MSA1OS45NDAxIDk4LjEzNDIgNjUuNTA4MiA5OS43NDI0IDY4LjkyMzFDOTkuNzU5IDY4Ljc2NjQgOTkuNzc5IDY4LjYwMjQgOTkuNzk0MSA2OC40Mjk4QzEwMC4wMDMgNjYuMDQzNSAxMDAuMDM5IDYyLjMzNDQgOTkuNzQ2NyA1Ni43MTMyQzk5LjU2MzUgNTMuMTk0MiA5OS4yMzU2IDUwLjE4MDkgOTguODg4OCA0Ni42ODI4Qzk4LjU0MjUgNDMuMTkwNCA5OC4xODQgMzkuMjcxMyA5Ny45NTUgMzQuMDMwMkM5Ny43NzIyIDI5Ljg0ODEgOTguMjAxMiAyNi42NzIyIDk5LjM2NzIgMjQuNDcxQzk5Ljk3MTYgMjMuMzMwMiAxMDAuNzkgMjIuNDIyMyAxMDEuODMgMjEuODE0QzEwMi44NjYgMjEuMjA4NyAxMDMuOTk1IDIwLjk3NCAxMDUuMTEgMjAuOTc0QzEwNi43NTkgMjAuOTc0IDEwOC44MTMgMjEuMjA2MiAxMTAuNDQ4IDIyLjc2NzhDMTEwLjU5MyAyMi40NTc2IDExMC43NSAyMi4xNjUyIDExMC45MjEgMjEuODg5OUMxMTEuNjc2IDIwLjY2OTggMTEyLjY4MSAxOS44MDg0IDExMy45MTIgMTkuMjgzNUMxMTUuMDk1IDE4Ljc3OTEgMTE2LjM3OCAxOC42MzA5IDExNy42NDYgMTguNjMxMUMxMjAuMTk1IDE4LjYzMTUgMTIyLjE2NCAxOS43NTY3IDEyMy40MzQgMjEuNDY4M0MxMjQuMjU2IDIyLjU3NiAxMjQuNzUgMjMuODc3NSAxMjQuOTg1IDI1LjE5ODJDMTI2LjMzOCAyNC41ODc2IDEyNy42OTEgMjQuNTA2OCAxMjguNTE5IDI0LjUwNjhDMTI5LjkzMyAyNC41MDY4IDEzMS43ODQgMjUuMDc5MSAxMzMuMzA1IDI2LjMxNTRDMTM0LjkwOCAyNy42MTc5IDEzNi4xNTkgMjkuNjczMyAxMzYuMTU5IDMyLjUwODNWMzUuNDI3OFoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik03LjE1NjYxIDYyLjAyOTJDNy4xNTY2MSA1OC40MDkgNi4xNzk5NCA0Ny42NzQ4IDUuODcyOTEgNDQuMTMyM0M1LjY2NTQgNDEuNzM3NCA1Ljk1MzU3IDQwLjQyNDcgNi4zMzg3NSAzOS43NTQyQzYuNjIxMTYgMzkuMjYyNiA3LjA2MzM2IDM4LjkxNSA4LjEyODM0IDM4Ljg0MzZDOC44OTc1OSAzOC43OTIxIDkuNzM1NDQgMzkuMDExNCAxMC4zNjE2IDM5LjU3NjFDMTAuOTQ4NCA0MC4xMDUyIDExLjYwMzIgNDEuMTY4MiAxMS42MDMyIDQzLjMxNzZMMTEuNjA3NCA0My40Mzg4TDEyLjU2NDQgNTkuNzU4QzEyLjU5ODggNjAuMzQ1MSAxMi44Nzk4IDYwLjg5MTEgMTMuMzM4IDYxLjI1OTlDMTMuNzk2MSA2MS42Mjg0IDE0LjM4ODcgNjEuNzg1OSAxNC45Njk1IDYxLjY5NDFMMjQuOTk4OCA2MC4xMDY4TDM1LjgxNDMgNTguNjcwM0MzNi44MTM1IDU4LjUzNzYgMzcuNTc0MSA1Ny43MDg0IDM3LjYyMDggNTYuNzAxNkwzOC4yMDE1IDQ0LjEzMjNDMzguMjI3OSA0My42MjEgMzguMjUyNSA0My4xMTQxIDM4LjI3ODQgNDIuNjE0NkMzOC41MjE4IDM3LjkyOTQgMzguNzQwMSAzMy43ODA1IDM4Ljc0MDEgMzIuNDI4MkMzOC43NDAxIDI4LjM4NTkgMzkuNDI0NiAyNi42ODA2IDQwLjAyMjcgMjUuOTYzNEM0MC40OTk2IDI1LjM5MTUgNDEuMTg1IDI1LjE0MDIgNDIuNjUyMyAyNS4xNDAyQzQzLjE3OTQgMjUuMTQwMiA0My41NTA1IDI1LjI0ODEgNDMuODI5NSAyNS40MTExQzQ0LjEwMzggMjUuNTcxNCA0NC40MTYgMjUuODU4NyA0NC43MTM4IDI2LjQyMDhDNDUuMzUyMSAyNy42MjU3IDQ1LjgxNzMgMjkuODkxIDQ1LjY0NDQgMzMuODQ3OUM0NS40MjAxIDM4Ljk4MDQgNDUuMDcwMyA0Mi44MTQ2IDQ0LjcyNzUgNDYuMjcxOEM0NC4zODUzIDQ5LjcyMzEgNDQuMDQ0MyA1Mi44NTYxIDQzLjg1NDggNTYuNDk3MUM0My41NTgyIDYyLjE5NjYgNDMuNTg0NyA2Ni4xMjU2IDQzLjgxNzkgNjguNzkyNEM0My45MzQ0IDcwLjEyNCA0NC4xMDY5IDcxLjE5OTYgNDQuMzM5NiA3Mi4wNTAxQzQ0LjU2MDEgNzIuODU1OCA0NC44OTEgNzMuNjc1NyA0NS40NjYzIDc0LjI4ODdDNDYuMTYyNSA3NS4wMzAzIDQ3LjE1NDYgNzUuMzg0NCA0OC4xODU1IDc1LjEzNkM0OS4wMDMzIDc0LjkzODkgNDkuNTc3OCA3NC40MjE1IDQ5Ljg5MTggNzQuMDkxNkM1MC41NDg0IDczLjQwMTcgNTEuMDEyMyA3Mi41MTA2IDUxLjE5NDUgNzIuMDUxMkM1Mi4yNTI3IDY5LjM4MTIgNTUuNTI3MiA2My4xODA4IDU5Ljk2MDEgNTkuNjgxMUM2MS4yNTM2IDU4LjY1OTkgNjIuMTk1OCA1OC4zNjUyIDYyLjc4ODkgNTguMzIwNEM2My4zNDc2IDU4LjI3ODMgNjMuNzUzIDU4LjQ0MzYgNjQuMDcxNSA1OC42OTY3QzY0LjQyMjUgNTguOTc1NiA2NC42ODQ0IDU5LjM4MTEgNjQuODE0NiA1OS43NjQzQzY0Ljg2MDYgNTkuODk5OSA2NC44ODAxIDU5Ljk5NjggNjQuODg4MyA2MC4wNTg0QzYzLjY4NjYgNjIuMDg2NSA1OC45MjA0IDY5LjUyMjIgNTYuNjcyOSA3Ny4wNjlDNTQuOTk3NyA4Mi42OTQxIDUwLjk1ODYgODguNDI1OSA0Ny45NDMxIDkwLjg4MDlDNDUuMDIyOSA5My4yNTggMzkuNzc0NyA5NC43MzEzIDMzLjg2MjQgOTUuMDIxOEMyOC4wMDY4IDk1LjMwOTUgMjEuOTc0OCA5NC40MTIxIDE3LjcyOTcgOTIuNTA5MkM5LjUyOTg4IDg4LjgzMzQgNy44NTk2MSA4MC43MzgyIDcuMTExMjkgNzcuMjI5MkM2LjUzMDU0IDc0LjUwNTcgNi41MTk1IDcxLjU5ODcgNi42NzQ5NiA2OC45MDA5QzYuNzUyNTEgNjcuNTU1MSA2Ljg2ODA5IDY2LjI5NjkgNi45NjkwMSA2NS4xMzczQzcuMDY3MDcgNjQuMDEwNSA3LjE1NjYgNjIuOTIxNSA3LjE1NjYxIDYyLjAyOTJaTTI2Ljc3NjggMjcuMDk1M0MyNi43NzY4IDI1LjgzMTQgMjcuMTE0NyAyNC43MDQ5IDI3LjY3MzcgMjMuOTUxNEMyOC4xNzkyIDIzLjI3IDI4LjkyMjEgMjIuNzk4NyAzMC4xMTY3IDIyLjc5ODRDMzEuMDk0MiAyMi43OTgyIDMxLjc1MTggMjIuOTE4NyAzMi4yMTYyIDIzLjExNjdDMzIuNjMyNiAyMy4yOTQzIDMyLjk4MTcgMjMuNTY5OSAzMy4yOTk2IDI0LjA4MzFDMzQuMDMyOCAyNS4yNjcxIDM0LjU3MDUgMjcuNjQ1NSAzNC41NzM4IDMyLjM4NEwzNC4wNDE2IDQzLjkwODhDMzMuODUyNCA0Ny41NjYxIDMzLjY1NjUgNTEuNDkyMiAzMy41MjczIDU0Ljc3MDdMMjYuNzc2OCA1NS42NjY2VjI3LjA5NTNaTTIyLjYwOTUgNTYuMjY1MkwxNi41OTA0IDU3LjIxOEwxNS43NzA1IDQzLjI2N1YzMi41MDgzQzE1Ljc3MDUgMzEuMDMxIDE2LjM3MjYgMzAuMTI3NSAxNy4wODQ3IDI5LjU0ODlDMTcuODc4NSAyOC45MDM5IDE4LjgwNTggMjguNjczMSAxOS4yNDMyIDI4LjY3MzFDMjAuMDQwNCAyOC42NzMxIDIwLjg2MzQgMjguNzk3IDIxLjQ1NjUgMjkuMjE3OUMyMS45MTMxIDI5LjU0MjEgMjIuNjA5NSAzMC4zMDg3IDIyLjYwOTUgMzIuNTA4M1Y1Ni4yNjUyWk0xMS42MDMyIDM1LjQyNzhDMTAuMzU2OCAzNC44MDY5IDkuMDIyNjUgMzQuNjA4MyA3Ljg1MDEgMzQuNjg2OEM1LjcyNTQxIDM0LjgyOTIgMy44NTE5NyAzNS43MTggMi43MjU4NCAzNy42Nzc5QzEuNzAyNDcgMzkuNDU5MiAxLjQ4OTI0IDQxLjgxMzYgMS43MjE0MyA0NC40OTI3QzIuMDQyMyA0OC4xOTQ5IDIuOTkwMzggNTguNjQ1NyAyLjk5MDM4IDYyLjAyOTJDMi45OTAzNyA2Mi43MDggMi45MTk5MSA2My42MTE2IDIuODE4NTkgNjQuNzc1OEMyLjcyMDE0IDY1LjkwNyAyLjU5Njk5IDY3LjIzODkgMi41MTUwNSA2OC42NjA2QzIuMzUxNSA3MS40OTg3IDIuMzQwNDEgNzQuODM4MyAzLjAzNTcgNzguMDk4N0MzLjc2MDA1IDgxLjQ5NTMgNS43MjE1NCA5MS42OTE4IDE2LjAyNDUgOTYuMzEwOEMyMS4wMzExIDk4LjU1NTEgMjcuNzYwMSA5OS40OTM2IDM0LjA2NjkgOTkuMTgzOEM0MC4zMTcyIDk4Ljg3NjcgNDYuNjM0NiA5Ny4zMTg5IDUwLjU3MzcgOTQuMTEyMkM1NC4yODE2IDkxLjA5MzcgNTguNzY4NiA4NC42MzA3IDYwLjY2NjIgNzguMjU4OUM2Mi44MDk1IDcxLjA2MTkgNjcuNDUxNSA2My45NjQ2IDY4LjYwOTggNjEuOTUzM0M2OS4yOTE5IDYwLjc2ODkgNjkuMDc4NSA1OS4zNjI4IDY4Ljc2MDUgNTguNDI1OEM2OC40MDE4IDU3LjM2ODggNjcuNzA3IDU2LjI2MzEgNjYuNjYzMiA1NS40MzM3QzY1LjU4NjcgNTQuNTc4NCA2NC4xNTgyIDU0LjAzNzcgNjIuNDc0OCA1NC4xNjQ3QzYwLjgyNTYgNTQuMjg5MyA1OS4xMTYyIDU1LjAzOTMgNTcuMzc5IDU2LjQxMDdDNTIuOTA4MyA1OS45NDAxIDQ5LjYyODMgNjUuNTA4MiA0OC4wMiA2OC45MjMxQzQ4LjAwMzQgNjguNzY2NCA0Ny45ODM1IDY4LjYwMjQgNDcuOTY4NCA2OC40Mjk4QzQ3Ljc1OTcgNjYuMDQzNSA0Ny43MjMyIDYyLjMzNDQgNDguMDE1OCA1Ni43MTMyQzQ4LjE5ODkgNTMuMTk0MiA0OC41MjY5IDUwLjE4MDkgNDguODczNyA0Ni42ODI4QzQ5LjIyIDQzLjE5MDQgNDkuNTc4NCAzOS4yNzEzIDQ5LjgwNzUgMzQuMDMwMkM0OS45OTAzIDI5Ljg0ODEgNDkuNTYxMiAyNi42NzIyIDQ4LjM5NTIgMjQuNDcxQzQ3Ljc5MDkgMjMuMzMwMiA0Ni45NzI5IDIyLjQyMjMgNDUuOTMyMSAyMS44MTRDNDQuODk2NCAyMS4yMDg3IDQzLjc2NzYgMjAuOTc0IDQyLjY1MjMgMjAuOTc0QzQxLjAwMzggMjAuOTc0IDM4Ljk0OTcgMjEuMjA2MiAzNy4zMTQxIDIyLjc2NzhDMzcuMTY5OCAyMi40NTc2IDM3LjAxMjQgMjIuMTY1MiAzNi44NDE5IDIxLjg4OTlDMzYuMDg2MyAyMC42Njk4IDM1LjA4MTcgMTkuODA4NCAzMy44NTA4IDE5LjI4MzVDMzIuNjY3OSAxOC43NzkxIDMxLjM4NDkgMTguNjMwOSAzMC4xMTY3IDE4LjYzMTFDMjcuNTY3NyAxOC42MzE1IDI1LjU5ODYgMTkuNzU2NyAyNC4zMjg1IDIxLjQ2ODNDMjMuNTA2NiAyMi41NzYgMjMuMDEyMSAyMy44Nzc1IDIyLjc3NzEgMjUuMTk4MkMyMS40MjQ3IDI0LjU4NzYgMjAuMDcxOCAyNC41MDY4IDE5LjI0MzIgMjQuNTA2OEMxNy44Mjk4IDI0LjUwNjggMTUuOTc4OCAyNS4wNzkxIDE0LjQ1NzMgMjYuMzE1NEMxMi44NTQyIDI3LjYxNzkgMTEuNjAzMiAyOS42NzMzIDExLjYwMzIgMzIuNTA4M1YzNS40Mjc4WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+Cg==",
            "Category": "FORM_LOGO",
            "ColorMode": "DARK",
            "Extension": "SVG",
          },
          {
            "Bytes": "PHN2ZyB3aWR0aD0iNDciIGhlaWdodD0iMzAiIHZpZXdCb3g9IjAgMCAxNDggMTAwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNNzEuNzU0IDE2Ljg2M1YyLjk3NDE0QzcxLjc1NCAxLjgyMzU1IDcyLjY4NzEgMC44OTA1MDMgNzMuODM3NyAwLjg5MDUwM0M3NC45ODgzIDAuODkwNTAzIDc1LjkyMTMgMS44MjM1NSA3NS45MjEzIDIuOTc0MTRWMTYuODYzQzc1LjkyMTMgMTguMDEzNiA3NC45ODgzIDE4Ljk0NjYgNzMuODM3NyAxOC45NDY2QzcyLjY4NzEgMTguOTQ2NiA3MS43NTQgMTguMDEzNiA3MS43NTQgMTYuODYzWiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTgyLjUyNzMgMTguOTMyOUw4OS40NzE3IDYuOTA0NzdDOTAuMDQ3IDUuOTA4MzIgOTEuMzIxNSA1LjU2NjggOTIuMzE4IDYuMTQyMUM5My4zMTQ0IDYuNzE3NCA5My42NTU5IDcuOTkxOTcgOTMuMDgwNiA4Ljk4ODQxTDg2LjEzNjIgMjEuMDE2NUM4NS41NjA5IDIyLjAxMjkgODQuMjg2NCAyMi4zNTQ1IDgzLjI4OTkgMjEuNzc5MkM4Mi4yOTM1IDIxLjIwMzkgODEuOTUyIDE5LjkyOTMgODIuNTI3MyAxOC45MzI5WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTY1LjE0ODEgMTguOTMyOUw1OC4yMDM3IDYuOTA0NzdDNTcuNjI4NCA1LjkwODMyIDU2LjM1MzggNS41NjY4IDU1LjM1NzQgNi4xNDIxQzU0LjM2MDkgNi43MTc0IDU0LjAxOTQgNy45OTE5NyA1NC41OTQ3IDguOTg4NDFMNjEuNTM5MSAyMS4wMTY1QzYyLjExNDQgMjIuMDEyOSA2My4zODkgMjIuMzU0NSA2NC4zODU0IDIxLjc3OTJDNjUuMzgxOSAyMS4yMDM5IDY1LjcyMzQgMTkuOTI5MyA2NS4xNDgxIDE4LjkzMjlaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNOTguNTA0NSA5Mi40OTY5Qzk1LjE0MjcgODkuNzYwMiA5MC44NzkzIDgzLjY2MjggODkuMDkyOSA3Ny42NjRDODYuODU5OCA3MC4xNjU1IDgyLjAzMDkgNjIuNzc3IDgwLjk1NzggNjAuOTEzOEM4MC4wMDU2IDU5LjI2MDIgODMuMDMxMyA1My4yNjA1IDg5LjA5MjkgNTguMDQ1OUM5My45NDIxIDYxLjg3NDIgOTcuMzg3OCA2OC40NjYgOTguNTA0NSA3MS4yODMzQzk4Ljk1NjYgNzIuNDIzOSAxMDMuMDA2IDc5LjI0NzUgMTAxLjgyNyA1Ni42MDUxQzEwMS40NTUgNDkuNDQ1IDEwMC40OSA0NC4zMTI2IDEwMC4wMzYgMzMuOTM4OEM5OS42ODA3IDI1Ljc5OTcgMTAxLjgyNCAyMy4wNTcgMTA1LjExIDIzLjA1N0MxMDguMzk2IDIzLjA1NyAxMTEuMTA2IDI0LjEyNDQgMTExLjEwNiAzMi40MjgzQzExMS4xMDYgMjIuODY4MiAxMTMuMTU0IDIwLjcxNDEgMTE3LjY0NiAyMC43MTQ3QzEyMS4zOSAyMC43MTUzIDEyMy4wNjkgMjMuOTA3NyAxMjMuMDY5IDI3LjA5NTJWMzIuNTA4NEMxMjMuMDY5IDI3LjA5NTIgMTI2LjY2OSAyNi41ODk2IDEyOC41MTkgMjYuNTg5NkMxMzAuMzcgMjYuNTg5NiAxMzQuMDc2IDI4LjE5NTcgMTM0LjA3NiAzMi41MDg0VjQzLjMxN0MxMzQuMDc2IDM4LjExNiAxMzcuMzI0IDM2LjYwMSAxMzkuNzczIDM2Ljc2NUMxNDIuOTYzIDM2Ljk3ODYgMTQ0LjQwNSAzOS4yMzgyIDE0My45NjUgNDQuMzEyNkMxNDMuNjUxIDQ3LjkzNDkgMTQyLjY4OSA1OC41MjczIDE0Mi42ODkgNjIuMDI5MUMxNDIuNjg5IDY1LjE3MTIgMTQzLjk2NSA3MS42ODAxIDE0Mi42ODkgNzcuNjY0QzE0MS45NTMgODEuMTE2OCAxNDAuMTM3IDkwLjI2MjggMTMwLjg4NSA5NC40MTAyQzEyMS42MzQgOTguNTU3NSAxMDUuMzY0IDk4LjA4MDcgOTguNTA0NSA5Mi40OTY5WiIgZmlsbD0iI0ZGRkY4QiIvPgo8cGF0aCBkPSJNMTQwLjYwNiA2Mi4wMjkyQzE0MC42MDYgNTguNDA5IDE0MS41ODMgNDcuNjc0OCAxNDEuODkgNDQuMTMyM0MxNDIuMDk3IDQxLjczNzQgMTQxLjgwOSA0MC40MjQ3IDE0MS40MjQgMzkuNzU0MkMxNDEuMTQxIDM5LjI2MjYgMTQwLjY5OSAzOC45MTUgMTM5LjYzNCAzOC44NDM2QzEzOC44NjUgMzguNzkyMSAxMzguMDI3IDM5LjAxMTQgMTM3LjQwMSAzOS41NzYxQzEzNi44MTQgNDAuMTA1MiAxMzYuMTU5IDQxLjE2ODIgMTM2LjE1OSA0My4zMTc2TDEzNi4xNTUgNDMuNDM4OEwxMzUuMTk4IDU5Ljc1OEMxMzUuMTY0IDYwLjM0NTEgMTM0Ljg4MyA2MC44OTExIDEzNC40MjQgNjEuMjU5OUMxMzMuOTY2IDYxLjYyODQgMTMzLjM3NCA2MS43ODU5IDEzMi43OTMgNjEuNjk0MUwxMjIuNzY0IDYwLjEwNjhMMTExLjk0OCA1OC42NzAzQzExMC45NDkgNTguNTM3NiAxMTAuMTg4IDU3LjcwODQgMTEwLjE0MiA1Ni43MDE2TDEwOS41NDUgNDMuODA1NUwxMDkuNTQgNDMuNjk1OUMxMDkuMjc0IDM4LjU2MDkgMTA5LjAyMiAzMy44NzY3IDEwOS4wMjIgMzIuNDI4MkMxMDkuMDIyIDI4LjM4NTkgMTA4LjMzOCAyNi42ODA2IDEwNy43NCAyNS45NjM0QzEwNy4yNjMgMjUuMzkxNSAxMDYuNTc3IDI1LjE0MDIgMTA1LjExIDI1LjE0MDJDMTA0LjU4MyAyNS4xNDAyIDEwNC4yMTIgMjUuMjQ4MSAxMDMuOTMzIDI1LjQxMTFDMTAzLjY1OSAyNS41NzE0IDEwMy4zNDYgMjUuODU4NyAxMDMuMDQ5IDI2LjQyMDhDMTAyLjQxIDI3LjYyNTcgMTAxLjk0NSAyOS44OTEgMTAyLjExOCAzMy44NDc5QzEwMi4zNDIgMzguOTgwNCAxMDIuNjkyIDQyLjgxNDYgMTAzLjAzNSA0Ni4yNzE4QzEwMy4zNzcgNDkuNzIzMSAxMDMuNzE4IDUyLjg1NjEgMTAzLjkwOCA1Ni40OTcxQzEwNC4yMDQgNjIuMTk2NiAxMDQuMTc4IDY2LjEyNTYgMTAzLjk0NSA2OC43OTI0QzEwMy44MjggNzAuMTI0IDEwMy42NTYgNzEuMTk5NiAxMDMuNDIzIDcyLjA1MDFDMTAzLjIwMiA3Mi44NTU4IDEwMi44NzEgNzMuNjc1NyAxMDIuMjk2IDc0LjI4ODdDMTAxLjYgNzUuMDMwMyAxMDAuNjA4IDc1LjM4NDQgOTkuNTc3IDc1LjEzNkM5OC43NTkyIDc0LjkzODkgOTguMTg0NyA3NC40MjE1IDk3Ljg3MDYgNzQuMDkxNkM5Ny4yMTQxIDczLjQwMTcgOTYuNzUwMSA3Mi41MTA2IDk2LjU2OCA3Mi4wNTEyQzk1LjUwOTcgNjkuMzgxMiA5Mi4yMzUyIDYzLjE4MDggODcuODAyMyA1OS42ODExQzg2LjUwODkgNTguNjU5OSA4NS41NjY2IDU4LjM2NTIgODQuOTczNiA1OC4zMjA0Qzg0LjQxNDggNTguMjc4MyA4NC4wMDk0IDU4LjQ0MzYgODMuNjkwOSA1OC42OTY3QzgzLjM0IDU4Ljk3NTYgODMuMDc4MSA1OS4zODExIDgyLjk0NzkgNTkuNzY0M0M4Mi45MDE5IDU5Ljg5OTkgODIuODgyMyA1OS45OTY4IDgyLjg3NDEgNjAuMDU4NEM4NC4wNzU5IDYyLjA4NjUgODguODQyMSA2OS41MjIyIDkxLjA4OTYgNzcuMDY5QzkyLjc2NDggODIuNjk0MSA5Ni44MDM4IDg4LjQyNTkgOTkuODE5NCA5MC44ODA5QzEwMi43NCA5My4yNTggMTA3Ljk4OCA5NC43MzEzIDExMy45IDk1LjAyMThDMTE5Ljc1NiA5NS4zMDk1IDEyNS43ODggOTQuNDEyMSAxMzAuMDMzIDkyLjUwOTJDMTM4LjIzMyA4OC44MzM0IDEzOS45MDMgODAuNzM4MiAxNDAuNjUxIDc3LjIyOTJDMTQxLjIzMiA3NC41MDU3IDE0MS4yNDMgNzEuNTk4NyAxNDEuMDg3IDY4LjkwMDlDMTQxLjAxIDY3LjU1NTEgMTQwLjg5NCA2Ni4yOTY5IDE0MC43OTMgNjUuMTM3M0MxNDAuNjk1IDY0LjAxMDUgMTQwLjYwNiA2Mi45MjE1IDE0MC42MDYgNjIuMDI5MlpNMTIwLjk4NiAyNy4wOTUzQzEyMC45ODYgMjUuODMxNCAxMjAuNjQ4IDI0LjcwNDkgMTIwLjA4OSAyMy45NTE0QzExOS41ODMgMjMuMjcgMTE4Ljg0IDIyLjc5ODcgMTE3LjY0NiAyMi43OTg0QzExNi42NjggMjIuNzk4MiAxMTYuMDExIDIyLjkxODcgMTE1LjU0NiAyMy4xMTY3QzExNS4xMyAyMy4yOTQzIDExNC43ODEgMjMuNTY5OSAxMTQuNDYzIDI0LjA4MzFDMTEzLjczIDI1LjI2NzEgMTEzLjE5MiAyNy42NDU1IDExMy4xODkgMzIuMzg0TDExMy43MDcgNDMuNjAyMUMxMTMuOTAxIDQ3LjM0NDMgMTE0LjEwMyA1MS4zOTk0IDExNC4yMzYgNTQuNzcwN0wxMjAuOTg2IDU1LjY2NjZWMjcuMDk1M1pNMTI1LjE1MyA1Ni4yNjUyTDEzMS4xNzIgNTcuMjE4TDEzMS45OTIgNDMuMjY3VjMyLjUwODNDMTMxLjk5MiAzMS4wMzEgMTMxLjM5IDMwLjEyNzUgMTMwLjY3OCAyOS41NDg5QzEyOS44ODQgMjguOTAzOSAxMjguOTU3IDI4LjY3MzEgMTI4LjUxOSAyOC42NzMxQzEyNy43MjIgMjguNjczMSAxMjYuODk5IDI4Ljc5NyAxMjYuMzA2IDI5LjIxNzlDMTI1Ljg0OSAyOS41NDIxIDEyNS4xNTMgMzAuMzA4NyAxMjUuMTUzIDMyLjUwODNWNTYuMjY1MlpNMTM2LjE1OSAzNS40Mjc4QzEzNy40MDYgMzQuODA2OSAxMzguNzQgMzQuNjA4MyAxMzkuOTEyIDM0LjY4NjhDMTQyLjAzNyAzNC44MjkyIDE0My45MSAzNS43MTggMTQ1LjAzNyAzNy42Nzc5QzE0Ni4wNiAzOS40NTkyIDE0Ni4yNzMgNDEuODEzNiAxNDYuMDQxIDQ0LjQ5MjdDMTQ1LjcyIDQ4LjE5NDkgMTQ0Ljc3MiA1OC42NDU3IDE0NC43NzIgNjIuMDI5MkMxNDQuNzcyIDYyLjcwOCAxNDQuODQzIDYzLjYxMTYgMTQ0Ljk0NCA2NC43NzU4QzE0NS4wNDIgNjUuOTA3IDE0NS4xNjUgNjcuMjM4OSAxNDUuMjQ3IDY4LjY2MDZDMTQ1LjQxMSA3MS40OTg3IDE0NS40MjIgNzQuODM4MyAxNDQuNzI3IDc4LjA5ODdDMTQ0LjAwMiA4MS40OTUzIDE0Mi4wNDEgOTEuNjkxOCAxMzEuNzM4IDk2LjMxMDhDMTI2LjczMSA5OC41NTUxIDEyMC4wMDIgOTkuNDkzNiAxMTMuNjk2IDk5LjE4MzhDMTA3LjQ0NSA5OC44NzY3IDEwMS4xMjggOTcuMzE4OSA5Ny4xODg3IDk0LjExMjJDOTMuNDgwOSA5MS4wOTM2IDg4Ljk5MzggODQuNjMwNyA4Ny4wOTYyIDc4LjI1ODlDODQuOTUyOSA3MS4wNjE5IDgwLjMxMDkgNjMuOTY0NiA3OS4xNTI3IDYxLjk1MzNDNzguNDcwNiA2MC43Njg5IDc4LjY4NCA1OS4zNjI4IDc5LjAwMTkgNTguNDI1OEM3OS4zNjA3IDU3LjM2ODggODAuMDU1NCA1Ni4yNjMxIDgxLjA5OTMgNTUuNDMzN0M4Mi4xNzU4IDU0LjU3ODQgODMuNjA0MyA1NC4wMzc3IDg1LjI4NzYgNTQuMTY0N0M4Ni45MzY5IDU0LjI4OTMgODguNjQ2MiA1NS4wMzkzIDkwLjM4MzQgNTYuNDEwN0M5NC44NTQxIDU5Ljk0MDEgOTguMTM0MiA2NS41MDgyIDk5Ljc0MjQgNjguOTIzMUM5OS43NTkgNjguNzY2NCA5OS43NzkgNjguNjAyNCA5OS43OTQxIDY4LjQyOThDMTAwLjAwMyA2Ni4wNDM1IDEwMC4wMzkgNjIuMzM0NCA5OS43NDY3IDU2LjcxMzJDOTkuNTYzNSA1My4xOTQyIDk5LjIzNTYgNTAuMTgwOSA5OC44ODg4IDQ2LjY4MjhDOTguNTQyNSA0My4xOTA0IDk4LjE4NCAzOS4yNzEzIDk3Ljk1NSAzNC4wMzAyQzk3Ljc3MjIgMjkuODQ4MSA5OC4yMDEyIDI2LjY3MjIgOTkuMzY3MiAyNC40NzFDOTkuOTcxNiAyMy4zMzAyIDEwMC43OSAyMi40MjIzIDEwMS44MyAyMS44MTRDMTAyLjg2NiAyMS4yMDg3IDEwMy45OTUgMjAuOTc0IDEwNS4xMSAyMC45NzRDMTA2Ljc1OSAyMC45NzQgMTA4LjgxMyAyMS4yMDYyIDExMC40NDggMjIuNzY3OEMxMTAuNTkzIDIyLjQ1NzYgMTEwLjc1IDIyLjE2NTIgMTEwLjkyMSAyMS44ODk5QzExMS42NzYgMjAuNjY5OCAxMTIuNjgxIDE5LjgwODQgMTEzLjkxMiAxOS4yODM1QzExNS4wOTUgMTguNzc5MSAxMTYuMzc4IDE4LjYzMDkgMTE3LjY0NiAxOC42MzExQzEyMC4xOTUgMTguNjMxNSAxMjIuMTY1IDE5Ljc1NjUgMTIzLjQzNSAyMS40NjgzQzEyNC4yNTcgMjIuNTc2IDEyNC43NSAyMy44Nzc2IDEyNC45ODUgMjUuMTk4MkMxMjYuMzM4IDI0LjU4NzYgMTI3LjY5MSAyNC41MDY4IDEyOC41MTkgMjQuNTA2OEMxMjkuOTMzIDI0LjUwNjggMTMxLjc4NCAyNS4wNzkxIDEzMy4zMDUgMjYuMzE1NEMxMzQuOTA4IDI3LjYxNzkgMTM2LjE1OSAyOS42NzMzIDEzNi4xNTkgMzIuNTA4M1YzNS40Mjc4WiIgZmlsbD0iYmxhY2siLz4KPHBhdGggZD0iTTQ5LjI1OCA5Mi40OTY5QzUyLjYxOTggODkuNzYwMiA1Ni44ODMyIDgzLjY2MjggNTguNjY5NiA3Ny42NjRDNjAuOTAyNyA3MC4xNjU1IDY1LjczMTYgNjIuNzc3IDY2LjgwNDcgNjAuOTEzOEM2Ny43NTcgNTkuMjYwMiA2NC43MzEyIDUzLjI2MDUgNTguNjY5NiA1OC4wNDU5QzUzLjgyMDQgNjEuODc0MiA1MC4zNzQ3IDY4LjQ2NiA0OS4yNTggNzEuMjgzM0M0OC44MDU5IDcyLjQyMzkgNDQuNzU2NiA3OS4yNDc1IDQ1LjkzNSA1Ni42MDUxQzQ2LjMwNzcgNDkuNDQ1IDQ3LjI3MjggNDQuMzEyNiA0Ny43MjYxIDMzLjkzODhDNDguMDgxOCAyNS43OTk3IDQ1LjkzODEgMjMuMDU3IDQyLjY1MjMgMjMuMDU3QzM5LjM2NjYgMjMuMDU3IDM2LjY1NjggMjQuMTI0NCAzNi42NTY4IDMyLjQyODNDMzYuNjU2OCAyMi44NjgyIDM0LjYwODcgMjAuNzE0MSAzMC4xMTY4IDIwLjcxNDdDMjYuMzcyOCAyMC43MTUzIDI0LjY5MzQgMjMuOTA3NyAyNC42OTM0IDI3LjA5NTJWMzIuNTA4NEMyNC42OTM0IDI3LjA5NTIgMjEuMDkzOCAyNi41ODk2IDE5LjI0MyAyNi41ODk2QzE3LjM5MjMgMjYuNTg5NiAxMy42ODcgMjguMTk1NyAxMy42ODcgMzIuNTA4NFY0My4zMTdDMTMuNjg3IDM4LjExNiAxMC40Mzg4IDM2LjYwMSA3Ljk4OTY4IDM2Ljc2NUM0Ljc5OTQzIDM2Ljk3ODYgMy4zNTc0IDM5LjIzODIgMy43OTcyMSA0NC4zMTI2QzQuMTExMTUgNDcuOTM0OSA1LjA3MzMxIDU4LjUyNzMgNS4wNzMzMSA2Mi4wMjkxQzUuMDczMzEgNjUuMTcxMiAzLjc5NzIxIDcxLjY4MDEgNS4wNzMzMSA3Ny42NjRDNS44MDk2NCA4MS4xMTY4IDcuNjI1NTEgOTAuMjYyOCAxNi44NzcyIDk0LjQxMDJDMjYuMTI5IDk4LjU1NzUgNDIuMzk4NyA5OC4wODA3IDQ5LjI1OCA5Mi40OTY5WiIgZmlsbD0iI0ZGRkY4QiIvPgo8cGF0aCBkPSJNNy4xNTY2NyA2Mi4wMjkyQzcuMTU2NjcgNTguNDA5IDYuMTgwMDEgNDcuNjc0OCA1Ljg3Mjk3IDQ0LjEzMjNDNS42NjU0NiA0MS43Mzc0IDUuOTUzNjMgNDAuNDI0NyA2LjMzODgxIDM5Ljc1NDJDNi42MjEyMiAzOS4yNjI2IDcuMDYzNDIgMzguOTE1IDguMTI4NCAzOC44NDM2QzguODk3NjUgMzguNzkyMSA5LjczNTUgMzkuMDExNCAxMC4zNjE3IDM5LjU3NjFDMTAuOTQ4NCA0MC4xMDUyIDExLjYwMzIgNDEuMTY4MiAxMS42MDMyIDQzLjMxNzZMMTEuNjA3NSA0My40Mzg4TDEyLjU2NDQgNTkuNzU4QzEyLjU5ODkgNjAuMzQ1MSAxMi44Nzk4IDYwLjg5MTEgMTMuMzM4IDYxLjI1OTlDMTMuNzk2MSA2MS42Mjg0IDE0LjM4ODggNjEuNzg1OSAxNC45Njk1IDYxLjY5NDFMMjQuOTk4OCA2MC4xMDY4TDM1LjgxNDQgNTguNjcwM0MzNi44MTM2IDU4LjUzNzYgMzcuNTc0MSA1Ny43MDg0IDM3LjYyMDggNTYuNzAxNkwzOC4yMTc0IDQzLjgwNTVMMzguMjIyNiA0My42OTU5QzM4LjQ4ODcgMzguNTYwOSAzOC43NDAxIDMzLjg3NjcgMzguNzQwMSAzMi40MjgyQzM4Ljc0MDEgMjguMzg1OSAzOS40MjQ2IDI2LjY4MDYgNDAuMDIyOCAyNS45NjM0QzQwLjQ5OTcgMjUuMzkxNSA0MS4xODUxIDI1LjE0MDIgNDIuNjUyMyAyNS4xNDAyQzQzLjE3OTUgMjUuMTQwMiA0My41NTA2IDI1LjI0ODEgNDMuODI5NiAyNS40MTExQzQ0LjEwMzggMjUuNTcxNCA0NC40MTYgMjUuODU4NyA0NC43MTM5IDI2LjQyMDhDNDUuMzUyMSAyNy42MjU3IDQ1LjgxNzQgMjkuODkxIDQ1LjY0NDUgMzMuODQ3OUM0NS40MjAyIDM4Ljk4MDQgNDUuMDcwMyA0Mi44MTQ2IDQ0LjcyNzYgNDYuMjcxOEM0NC4zODU0IDQ5LjcyMzEgNDQuMDQ0NCA1Mi44NTYxIDQzLjg1NDkgNTYuNDk3MUM0My41NTgzIDYyLjE5NjYgNDMuNTg0OCA2Ni4xMjU2IDQzLjgxOCA2OC43OTI0QzQzLjkzNDUgNzAuMTI0IDQ0LjEwNyA3MS4xOTk2IDQ0LjMzOTcgNzIuMDUwMUM0NC41NjAyIDcyLjg1NTggNDQuODkxIDczLjY3NTcgNDUuNDY2NCA3NC4yODg3QzQ2LjE2MjYgNzUuMDMwMyA0Ny4xNTQ3IDc1LjM4NDQgNDguMTg1NSA3NS4xMzZDNDkuMDAzMyA3NC45Mzg5IDQ5LjU3NzkgNzQuNDIxNSA0OS44OTE5IDc0LjA5MTZDNTAuNTQ4NCA3My40MDE3IDUxLjAxMjQgNzIuNTEwNiA1MS4xOTQ1IDcyLjA1MTJDNTIuMjUyOCA2OS4zODEyIDU1LjUyNzMgNjMuMTgwOCA1OS45NjAyIDU5LjY4MTFDNjEuMjUzNiA1OC42NTk5IDYyLjE5NTkgNTguMzY1MiA2Mi43ODg5IDU4LjMyMDRDNjMuMzQ3NyA1OC4yNzgzIDYzLjc1MzEgNTguNDQzNiA2NC4wNzE2IDU4LjY5NjdDNjQuNDIyNSA1OC45NzU2IDY0LjY4NDQgNTkuMzgxMSA2NC44MTQ2IDU5Ljc2NDNDNjQuODYwNiA1OS44OTk5IDY0Ljg4MDIgNTkuOTk2OCA2NC44ODg0IDYwLjA1ODRDNjMuNjg2NiA2Mi4wODY1IDU4LjkyMDUgNjkuNTIyMiA1Ni42NzI5IDc3LjA2OUM1NC45OTc4IDgyLjY5NDEgNTAuOTU4NyA4OC40MjU5IDQ3Ljk0MzEgOTAuODgwOUM0NS4wMjI5IDkzLjI1OCAzOS43NzQ4IDk0LjczMTMgMzMuODYyNSA5NS4wMjE4QzI4LjAwNjkgOTUuMzA5NSAyMS45NzQ4IDk0LjQxMjEgMTcuNzI5OCA5Mi41MDkyQzkuNTI5OTQgODguODMzNCA3Ljg1OTY4IDgwLjczODIgNy4xMTEzNSA3Ny4yMjkyQzYuNTMwNiA3NC41MDU3IDYuNTE5NTYgNzEuNTk4NyA2LjY3NTAyIDY4LjkwMDlDNi43NTI1NyA2Ny41NTUxIDYuODY4MTUgNjYuMjk2OSA2Ljk2OTA3IDY1LjEzNzNDNy4wNjcxMyA2NC4wMTA1IDcuMTU2NjYgNjIuOTIxNSA3LjE1NjY3IDYyLjAyOTJaTTI2Ljc3NjggMjcuMDk1M0MyNi43NzY4IDI1LjgzMTQgMjcuMTE0OCAyNC43MDQ5IDI3LjY3MzcgMjMuOTUxNEMyOC4xNzkzIDIzLjI3IDI4LjkyMjEgMjIuNzk4NyAzMC4xMTY4IDIyLjc5ODRDMzEuMDk0MiAyMi43OTgyIDMxLjc1MTkgMjIuOTE4NyAzMi4yMTYyIDIzLjExNjdDMzIuNjMyNyAyMy4yOTQzIDMyLjk4MTggMjMuNTY5OSAzMy4yOTk3IDI0LjA4MzFDMzQuMDMyOSAyNS4yNjcxIDM0LjU3MDYgMjcuNjQ1NSAzNC41NzM5IDMyLjM4NEwzNC4wNTU0IDQzLjYwMjFDMzMuODYxNSA0Ny4zNDQzIDMzLjY1OTIgNTEuMzk5NCAzMy41MjYzIDU0Ljc3MDdMMjYuNzc2OCA1NS42NjY2VjI3LjA5NTNaTTIyLjYwOTYgNTYuMjY1MkwxNi41OTA1IDU3LjIxOEwxNS43NzA1IDQzLjI2N1YzMi41MDgzQzE1Ljc3MDUgMzEuMDMxIDE2LjM3MjYgMzAuMTI3NSAxNy4wODQ4IDI5LjU0ODlDMTcuODc4NiAyOC45MDM5IDE4LjgwNTkgMjguNjczMSAxOS4yNDMzIDI4LjY3MzFDMjAuMDQwNSAyOC42NzMxIDIwLjg2MzUgMjguNzk3IDIxLjQ1NjUgMjkuMjE3OUMyMS45MTMxIDI5LjU0MjEgMjIuNjA5NSAzMC4zMDg3IDIyLjYwOTYgMzIuNTA4M1Y1Ni4yNjUyWk0xMS42MDMyIDM1LjQyNzhDMTAuMzU2OCAzNC44MDY5IDkuMDIyNzEgMzQuNjA4MyA3Ljg1MDE2IDM0LjY4NjhDNS43MjU0NyAzNC44MjkyIDMuODUyMDMgMzUuNzE4IDIuNzI1OSAzNy42Nzc5QzEuNzAyNTMgMzkuNDU5MiAxLjQ4OTMgNDEuODEzNiAxLjcyMTUgNDQuNDkyN0MyLjA0MjM3IDQ4LjE5NDkgMi45OTA0NCA1OC42NDU3IDIuOTkwNDQgNjIuMDI5MkMyLjk5MDQzIDYyLjcwOCAyLjkxOTk3IDYzLjYxMTYgMi44MTg2NSA2NC43NzU4QzIuNzIwMiA2NS45MDcgMi41OTcwNSA2Ny4yMzg5IDIuNTE1MTEgNjguNjYwNkMyLjM1MTU2IDcxLjQ5ODcgMi4zNDA0NyA3NC44MzgzIDMuMDM1NzYgNzguMDk4N0MzLjc2MDExIDgxLjQ5NTMgNS43MjE2IDkxLjY5MTggMTYuMDI0NSA5Ni4zMTA4QzIxLjAzMTIgOTguNTU1MSAyNy43NjAxIDk5LjQ5MzYgMzQuMDY2OSA5OS4xODM4QzQwLjMxNzMgOTguODc2NyA0Ni42MzQ2IDk3LjMxODkgNTAuNTczOCA5NC4xMTIyQzU0LjI4MTYgOTEuMDkzNiA1OC43Njg3IDg0LjYzMDcgNjAuNjY2MyA3OC4yNTg5QzYyLjgwOTYgNzEuMDYxOSA2Ny40NTE2IDYzLjk2NDYgNjguNjA5OSA2MS45NTMzQzY5LjI5MiA2MC43Njg5IDY5LjA3ODUgNTkuMzYyOCA2OC43NjA2IDU4LjQyNThDNjguNDAxOCA1Ny4zNjg4IDY3LjcwNzEgNTYuMjYzMSA2Ni42NjMyIDU1LjQzMzdDNjUuNTg2NyA1NC41Nzg0IDY0LjE1ODIgNTQuMDM3NyA2Mi40NzQ5IDU0LjE2NDdDNjAuODI1NiA1NC4yODkzIDU5LjExNjMgNTUuMDM5MyA1Ny4zNzkxIDU2LjQxMDdDNTIuOTA4NCA1OS45NDAxIDQ5LjYyODMgNjUuNTA4MiA0OC4wMjAxIDY4LjkyMzFDNDguMDAzNSA2OC43NjY0IDQ3Ljk4MzUgNjguNjAyNCA0Ny45Njg0IDY4LjQyOThDNDcuNzU5NyA2Ni4wNDM1IDQ3LjcyMzMgNjIuMzM0NCA0OC4wMTU5IDU2LjcxMzJDNDguMTk5IDUzLjE5NDIgNDguNTI2OSA1MC4xODA5IDQ4Ljg3MzggNDYuNjgyOEM0OS4yMiA0My4xOTA0IDQ5LjU3ODUgMzkuMjcxMyA0OS44MDc2IDM0LjAzMDJDNDkuOTkwMyAyOS44NDgxIDQ5LjU2MTMgMjYuNjcyMiA0OC4zOTUzIDI0LjQ3MUM0Ny43OTA5IDIzLjMzMDIgNDYuOTcyOSAyMi40MjIzIDQ1LjkzMjIgMjEuODE0QzQ0Ljg5NjQgMjEuMjA4NyA0My43Njc2IDIwLjk3NCA0Mi42NTIzIDIwLjk3NEM0MS4wMDM4IDIwLjk3NCAzOC45NDk4IDIxLjIwNjIgMzcuMzE0MSAyMi43Njc4QzM3LjE2OTkgMjIuNDU3NiAzNy4wMTI1IDIyLjE2NTIgMzYuODQyIDIxLjg4OTlDMzYuMDg2NCAyMC42Njk4IDM1LjA4MTcgMTkuODA4NCAzMy44NTA5IDE5LjI4MzVDMzIuNjY4IDE4Ljc3OTEgMzEuMzg0OSAxOC42MzA5IDMwLjExNjggMTguNjMxMUMyNy41Njc2IDE4LjYzMTUgMjUuNTk3NiAxOS43NTY1IDI0LjMyNzUgMjEuNDY4M0MyMy41MDU3IDIyLjU3NiAyMy4wMTIxIDIzLjg3NzYgMjIuNzc3MSAyNS4xOTgyQzIxLjQyNDggMjQuNTg3NiAyMC4wNzE4IDI0LjUwNjggMTkuMjQzMyAyNC41MDY4QzE3LjgyOTkgMjQuNTA2OCAxNS45Nzg5IDI1LjA3OTEgMTQuNDU3MyAyNi4zMTU0QzEyLjg1NDMgMjcuNjE3OSAxMS42MDMzIDI5LjY3MzMgMTEuNjAzMiAzMi41MDgzVjM1LjQyNzhaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K",
            "Category": "FORM_LOGO",
            "ColorMode": "LIGHT",
            "Extension": "SVG",
          },
          {
            "Bytes": "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+CiAgPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iMTQiIGZpbGw9IiMwZDBmMTEiLz4KICA8dGV4dAogICAgeD0iMzIiCiAgICB5PSIzOCIKICAgIHRleHQtYW5jaG9yPSJtaWRkbGUiCiAgICBmb250LWZhbWlseT0iT3V0Zml0LCB1aS1zYW5zLXNlcmlmLCBzeXN0ZW0tdWksIC1hcHBsZS1zeXN0ZW0sIFNlZ29lIFVJLCBSb2JvdG8sIFVidW50dSIKICAgIGZvbnQtc2l6ZT0iMjgiCiAgICBmb250LXdlaWdodD0iODAwIgogICAgZmlsbD0iI2M5Yjk3NCIKICAgIGxldHRlci1zcGFjaW5nPSItMSIKICA+T0g8L3RleHQ+Cjwvc3ZnPgo=",
            "Category": "FAVICON_SVG",
            "ColorMode": "DARK",
            "Extension": "SVG",
          },
          {
            "Bytes": "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+CiAgPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iMTQiIGZpbGw9IiMwZDBmMTEiLz4KICA8dGV4dAogICAgeD0iMzIiCiAgICB5PSIzOCIKICAgIHRleHQtYW5jaG9yPSJtaWRkbGUiCiAgICBmb250LWZhbWlseT0iT3V0Zml0LCB1aS1zYW5zLXNlcmlmLCBzeXN0ZW0tdWksIC1hcHBsZS1zeXN0ZW0sIFNlZ29lIFVJLCBSb2JvdG8sIFVidW50dSIKICAgIGZvbnQtc2l6ZT0iMjgiCiAgICBmb250LXdlaWdodD0iODAwIgogICAgZmlsbD0iI2M5Yjk3NCIKICAgIGxldHRlci1zcGFjaW5nPSItMSIKICA+T0g8L3RleHQ+Cjwvc3ZnPgo=",
            "Category": "FAVICON_SVG",
            "ColorMode": "LIGHT",
            "Extension": "SVG",
          },
        ],
        "ClientId": {
          "Ref": "UserPoolWebAppClientCD2D5CB1",
        },
        "ReturnMergedResources": false,
        "Settings": {
          "categories": {
            "auth": {
              "authMethodOrder": [
                [
                  {
                    "display": "INPUT",
                    "type": "USERNAME_PASSWORD",
                  },
                ],
              ],
              "federation": {
                "interfaceStyle": "BUTTON_LIST",
                "order": [],
              },
            },
            "form": {
              "displayGraphics": true,
              "instructions": {
                "enabled": false,
              },
              "languageSelector": {
                "enabled": false,
              },
              "location": {
                "horizontal": "CENTER",
                "vertical": "CENTER",
              },
              "sessionTimerDisplay": "NONE",
            },
            "global": {
              "colorSchemeMode": "DARK",
              "pageFooter": {
                "enabled": false,
              },
              "pageHeader": {
                "enabled": false,
              },
              "spacingDensity": "REGULAR",
            },
          },
          "componentClasses": {
            "buttons": {
              "borderRadius": 10,
            },
            "focusState": {
              "darkMode": {
                "borderColor": "c9b974ff",
              },
              "lightMode": {
                "borderColor": "c9b974ff",
              },
            },
            "input": {
              "borderRadius": 10,
              "darkMode": {
                "defaults": {
                  "backgroundColor": "393939ff",
                  "borderColor": "3c3c4aff",
                },
                "placeholderColor": "9099acff",
              },
              "lightMode": {
                "defaults": {
                  "backgroundColor": "ffffffff",
                  "borderColor": "3c3c4aff",
                },
                "placeholderColor": "9099acff",
              },
            },
            "inputDescription": {
              "darkMode": {
                "textColor": "9099acff",
              },
              "lightMode": {
                "textColor": "4b5563ff",
              },
            },
            "inputLabel": {
              "darkMode": {
                "textColor": "c4cbdaff",
              },
              "lightMode": {
                "textColor": "111827ff",
              },
            },
            "link": {
              "darkMode": {
                "defaults": {
                  "textColor": "c9b974ff",
                },
                "hover": {
                  "textColor": "cfb755ff",
                },
              },
              "lightMode": {
                "defaults": {
                  "textColor": "c9b974ff",
                },
                "hover": {
                  "textColor": "cfb755ff",
                },
              },
            },
          },
          "components": {
            "favicon": {
              "enabledTypes": [
                "SVG",
              ],
            },
            "form": {
              "backgroundImage": {
                "enabled": false,
              },
              "borderRadius": 12,
              "darkMode": {
                "backgroundColor": "24272eff",
                "borderColor": "3c3c4aff",
              },
              "lightMode": {
                "backgroundColor": "ffffffff",
                "borderColor": "3c3c4aff",
              },
              "logo": {
                "enabled": true,
                "formInclusion": "IN",
                "location": "CENTER",
                "position": "TOP",
              },
            },
            "pageBackground": {
              "darkMode": {
                "color": "0d0f11ff",
              },
              "image": {
                "enabled": false,
              },
              "lightMode": {
                "color": "f8fafcff",
              },
            },
          },
        },
        "UseCognitoProvidedValues": false,
        "UserPoolId": {
          "Ref": "UserPool6BA7E5F2",
        },
      },
      "Type": "AWS::Cognito::ManagedLoginBranding",
    },
    "UserPool6BA7E5F2": {
      "DeletionPolicy": "Retain",
      "Properties": {
        "AccountRecoverySetting": {
          "RecoveryMechanisms": [
            {
              "Name": "verified_email",
              "Priority": 1,
            },
          ],
        },
        "AdminCreateUserConfig": {
          "AllowAdminCreateUserOnly": true,
        },
        "AutoVerifiedAttributes": [
          "email",
        ],
        "EmailVerificationMessage": "The verification code to your new account is {####}",
        "EmailVerificationSubject": "Verify your new account",
        "EnabledMfas": [
          "SOFTWARE_TOKEN_MFA",
        ],
        "MfaConfiguration": "OPTIONAL",
        "Policies": {
          "PasswordPolicy": {
            "MinimumLength": 8,
            "RequireLowercase": true,
            "RequireNumbers": true,
            "RequireSymbols": true,
            "RequireUppercase": true,
          },
        },
        "Schema": [
          {
            "Mutable": true,
            "Name": "email",
            "Required": true,
          },
        ],
        "SmsVerificationMessage": "The verification code to your new account is {####}",
        "UserPoolName": "Openhands on AWS",
        "UsernameAttributes": [
          "email",
        ],
        "VerificationMessageTemplate": {
          "DefaultEmailOption": "CONFIRM_WITH_CODE",
          "EmailMessage": "The verification code to your new account is {####}",
          "EmailSubject": "Verify your new account",
          "SmsMessage": "The verification code to your new account is {####}",
        },
      },
      "Type": "AWS::Cognito::UserPool",
      "UpdateReplacePolicy": "Retain",
    },
    "UserPoolCognitoDomainD6C7F9FA": {
      "Properties": {
        "Domain": {
          "Fn::Join": [
            "",
            [
              "openhands-",
              {
                "Ref": "AWS::AccountId",
              },
              "-shared",
            ],
          ],
        },
        "ManagedLoginVersion": 2,
        "UserPoolId": {
          "Ref": "UserPool6BA7E5F2",
        },
      },
      "Type": "AWS::Cognito::UserPoolDomain",
    },
    "UserPoolWebAppClientCD2D5CB1": {
      "Properties": {
        "AccessTokenValidity": 60,
        "AllowedOAuthFlows": [
          "code",
        ],
        "AllowedOAuthFlowsUserPoolClient": true,
        "AllowedOAuthScopes": [
          "openid",
          "email",
          "profile",
        ],
        "CallbackURLs": [
          "https://openhands.example.com/_callback",
        ],
        "ClientName": "Openhands on AWS",
        "ExplicitAuthFlows": [
          "ALLOW_USER_PASSWORD_AUTH",
          "ALLOW_USER_SRP_AUTH",
          "ALLOW_REFRESH_TOKEN_AUTH",
        ],
        "GenerateSecret": true,
        "IdTokenValidity": 1440,
        "LogoutURLs": [
          "https://openhands.example.com/",
        ],
        "PreventUserExistenceErrors": "ENABLED",
        "RefreshTokenValidity": 43200,
        "SupportedIdentityProviders": [
          "COGNITO",
        ],
        "TokenValidityUnits": {
          "AccessToken": "minutes",
          "IdToken": "minutes",
          "RefreshToken": "minutes",
        },
        "UserPoolId": {
          "Ref": "UserPool6BA7E5F2",
        },
      },
      "Type": "AWS::Cognito::UserPoolClient",
    },
    "UserPoolWebAppClientDescribeCognitoUserPoolClient2F6BCD92": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "UserPoolWebAppClientDescribeCognitoUserPoolClientCustomResourcePolicyE5658F8D",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"region":"us-east-1","service":"CognitoIdentityServiceProvider","action":"describeUserPoolClient","parameters":{"UserPoolId":"",
              {
                "Ref": "UserPool6BA7E5F2",
              },
              "","ClientId":"",
              {
                "Ref": "UserPoolWebAppClientCD2D5CB1",
              },
              ""},"physicalResourceId":{"id":"",
              {
                "Ref": "UserPoolWebAppClientCD2D5CB1",
              },
              ""},"logApiResponseData":false}",
            ],
          ],
        },
        "InstallLatestAwsSdk": false,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"region":"us-east-1","service":"CognitoIdentityServiceProvider","action":"describeUserPoolClient","parameters":{"UserPoolId":"",
              {
                "Ref": "UserPool6BA7E5F2",
              },
              "","ClientId":"",
              {
                "Ref": "UserPoolWebAppClientCD2D5CB1",
              },
              ""},"physicalResourceId":{"id":"",
              {
                "Ref": "UserPoolWebAppClientCD2D5CB1",
              },
              ""},"logApiResponseData":false}",
            ],
          ],
        },
      },
      "Type": "Custom::DescribeCognitoUserPoolClient",
      "UpdateReplacePolicy": "Delete",
    },
    "UserPoolWebAppClientDescribeCognitoUserPoolClientCustomResourcePolicyE5658F8D": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "cognito-idp:DescribeUserPoolClient",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "UserPool6BA7E5F2",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "UserPoolWebAppClientDescribeCognitoUserPoolClientCustomResourcePolicyE5658F8D",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`OpenHands Infrastructure Stacks ComputeStack matches snapshot 1`] = `
{
  "Outputs": {
    "AlbArn": {
      "Description": "ALB ARN",
      "Value": {
        "Ref": "OpenHandsAlb343FAEDA",
      },
    },
    "AlbDnsName": {
      "Description": "ALB DNS Name",
      "Value": {
        "Fn::GetAtt": [
          "OpenHandsAlb343FAEDA",
          "DNSName",
        ],
      },
    },
    "AsgName": {
      "Description": "Auto Scaling Group Name",
      "Value": {
        "Ref": "OpenHandsAsgASG16C624EA",
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueawsserviceamiamazonlinuxlatestal2023amikernel61arm64C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/aws/service/ami-amazon-linux-latest/al2023-ami-kernel-6.1-arm64",
      "Type": "AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>",
    },
  },
  "Resources": {
    "AWS679f53fac002430cb0da5b7982bd22872D164C4C": {
      "DependsOn": [
        "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-123456789012-us-west-2",
          "S3Key": "bc8ef58951f4c88e641dd23090e9d2e2e61c7530a07960e767522941e959b625.zip",
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 120,
      },
      "Type": "AWS::Lambda::Function",
    },
    "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CpuAlarm87CA37A9": {
      "Properties": {
        "AlarmActions": [
          {
            "Fn::ImportValue": "TestMonitoringStack:ExportsOutputRefAlertTopic2720D5359ADB6D3E",
          },
        ],
        "AlarmDescription": "CPU utilization exceeds 80%",
        "ComparisonOperator": "GreaterThanThreshold",
        "Dimensions": [
          {
            "Name": "AutoScalingGroupName",
            "Value": {
              "Ref": "OpenHandsAsgASG16C624EA",
            },
          },
        ],
        "EvaluationPeriods": 2,
        "MetricName": "CPUUtilization",
        "Namespace": "AWS/EC2",
        "Period": 300,
        "Statistic": "Average",
        "Threshold": 80,
        "TreatMissingData": "notBreaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "DiskAlarm26803A32": {
      "Properties": {
        "AlarmActions": [
          {
            "Fn::ImportValue": "TestMonitoringStack:ExportsOutputRefAlertTopic2720D5359ADB6D3E",
          },
        ],
        "AlarmDescription": "Disk usage exceeds 85%",
        "ComparisonOperator": "GreaterThanThreshold",
        "Dimensions": [
          {
            "Name": "AutoScalingGroupName",
            "Value": {
              "Ref": "OpenHandsAsgASG16C624EA",
            },
          },
          {
            "Name": "path",
            "Value": "/data",
          },
        ],
        "EvaluationPeriods": 2,
        "MetricName": "disk_used_percent",
        "Namespace": "CWAgent",
        "Period": 300,
        "Statistic": "Average",
        "Threshold": 85,
        "TreatMissingData": "notBreaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "MemoryAlarm2E786DB4": {
      "Properties": {
        "AlarmActions": [
          {
            "Fn::ImportValue": "TestMonitoringStack:ExportsOutputRefAlertTopic2720D5359ADB6D3E",
          },
        ],
        "AlarmDescription": "Memory utilization exceeds 85%",
        "ComparisonOperator": "GreaterThanThreshold",
        "Dimensions": [
          {
            "Name": "AutoScalingGroupName",
            "Value": {
              "Ref": "OpenHandsAsgASG16C624EA",
            },
          },
        ],
        "EvaluationPeriods": 2,
        "MetricName": "mem_used_percent",
        "Namespace": "CWAgent",
        "Period": 300,
        "Statistic": "Average",
        "Threshold": 85,
        "TreatMissingData": "notBreaching",
      },
      "Type": "AWS::CloudWatch::Alarm",
    },
    "OpenHandsAlb343FAEDA": {
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false",
          },
        ],
        "Scheme": "internet-facing",
        "SecurityGroups": [
          {
            "Fn::ImportValue": "TestSecurityStack:ExportsOutputFnGetAttAlbSecurityGroup86A59E99GroupIdE3A37BC7",
          },
        ],
        "Subnets": [
          "s-12345",
          "s-67890",
        ],
        "Type": "application",
      },
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
    },
    "OpenHandsAlbHttpListener244F6A31": {
      "Properties": {
        "DefaultActions": [
          {
            "FixedResponseConfig": {
              "ContentType": "text/plain",
              "MessageBody": "Access Denied - Invalid Origin",
              "StatusCode": "403",
            },
            "Type": "fixed-response",
          },
        ],
        "LoadBalancerArn": {
          "Ref": "OpenHandsAlb343FAEDA",
        },
        "Port": 80,
        "Protocol": "HTTP",
      },
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
    },
    "OpenHandsAlbHttpListenerVerifiedMainRuleRule40A43613": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "OpenHandsTargetGroupB296B707",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "http-header",
            "HttpHeaderConfig": {
              "HttpHeaderName": "X-Origin-Verify",
              "Values": [
                {
                  "Fn::Select": [
                    2,
                    {
                      "Fn::Split": [
                        "/",
                        {
                          "Ref": "AWS::StackId",
                        },
                      ],
                    },
                  ],
                },
              ],
            },
          },
        ],
        "ListenerArn": {
          "Ref": "OpenHandsAlbHttpListener244F6A31",
        },
        "Priority": 20,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "OpenHandsAlbHttpListenerVerifiedRuntimeRuleRule1C3988A0": {
      "Properties": {
        "Actions": [
          {
            "TargetGroupArn": {
              "Ref": "RuntimeTargetGroup77A6315C",
            },
            "Type": "forward",
          },
        ],
        "Conditions": [
          {
            "Field": "path-pattern",
            "PathPatternConfig": {
              "Values": [
                "/runtime/*",
              ],
            },
          },
          {
            "Field": "http-header",
            "HttpHeaderConfig": {
              "HttpHeaderName": "X-Origin-Verify",
              "Values": [
                {
                  "Fn::Select": [
                    2,
                    {
                      "Fn::Split": [
                        "/",
                        {
                          "Ref": "AWS::StackId",
                        },
                      ],
                    },
                  ],
                },
              ],
            },
          },
        ],
        "ListenerArn": {
          "Ref": "OpenHandsAlbHttpListener244F6A31",
        },
        "Priority": 10,
      },
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
    },
    "OpenHandsAsgASG16C624EA": {
      "Properties": {
        "HealthCheckGracePeriod": 600,
        "HealthCheckType": "ELB",
        "LaunchTemplate": {
          "LaunchTemplateId": {
            "Ref": "OpenHandsLaunchTemplate41AB5D4E",
          },
          "Version": {
            "Fn::GetAtt": [
              "OpenHandsLaunchTemplate41AB5D4E",
              "LatestVersionNumber",
            ],
          },
        },
        "MaxSize": "1",
        "MinSize": "1",
        "NewInstancesProtectedFromScaleIn": false,
        "TargetGroupARNs": [
          {
            "Ref": "OpenHandsTargetGroupB296B707",
          },
          {
            "Ref": "RuntimeTargetGroup77A6315C",
          },
        ],
        "VPCZoneIdentifier": [
          "p-12345",
          "p-67890",
        ],
      },
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "UpdatePolicy": {
        "AutoScalingRollingUpdate": {
          "SuspendProcesses": [
            "HealthCheck",
            "ReplaceUnhealthy",
            "AZRebalance",
            "AlarmNotification",
            "ScheduledActions",
            "InstanceRefresh",
          ],
        },
        "AutoScalingScheduledAction": {
          "IgnoreUnmodifiedGroupSizeProperties": true,
        },
      },
    },
    "OpenHandsLaunchTemplate41AB5D4E": {
      "Properties": {
        "LaunchTemplateData": {
          "BlockDeviceMappings": [
            {
              "DeviceName": "/dev/xvda",
              "Ebs": {
                "Encrypted": true,
                "Iops": 3000,
                "Throughput": 125,
                "VolumeSize": 30,
                "VolumeType": "gp3",
              },
            },
            {
              "DeviceName": "/dev/sdf",
              "Ebs": {
                "DeleteOnTermination": false,
                "Encrypted": true,
                "Iops": 3000,
                "Throughput": 125,
                "VolumeSize": 100,
                "VolumeType": "gp3",
              },
            },
          ],
          "IamInstanceProfile": {
            "Arn": {
              "Fn::GetAtt": [
                "OpenHandsLaunchTemplateProfile0C9EFCAE",
                "Arn",
              ],
            },
          },
          "ImageId": {
            "Ref": "SsmParameterValueawsserviceamiamazonlinuxlatestal2023amikernel61arm64C96584B6F00A464EAD1953AFF4B05118Parameter",
          },
          "InstanceType": "m7g.xlarge",
          "MetadataOptions": {
            "HttpTokens": "required",
          },
          "SecurityGroupIds": [
            {
              "Fn::ImportValue": "TestSecurityStack:ExportsOutputFnGetAttEc2SecurityGroup55889913GroupId170771B5",
            },
          ],
          "TagSpecifications": [
            {
              "ResourceType": "instance",
              "Tags": [
                {
                  "Key": "Name",
                  "Value": "TestComputeStack/OpenHandsLaunchTemplate",
                },
              ],
            },
            {
              "ResourceType": "volume",
              "Tags": [
                {
                  "Key": "Name",
                  "Value": "TestComputeStack/OpenHandsLaunchTemplate",
                },
              ],
            },
          ],
          "UserData": {
            "Fn::Base64": {
              "Fn::Join": [
                "",
                [
                  "#!/bin/bash
#!/bin/bash
set -ex
exec > >(tee /var/log/user-data.log) 2>&1
TOKEN=$(curl -s -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600")
INSTANCE_ID=$(curl -s -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/instance-id)
REGION=$(curl -s -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/placement/region)
error_handler() { aws sns publish --topic-arn "",
                  {
                    "Fn::ImportValue": "TestMonitoringStack:ExportsOutputRefAlertTopic2720D5359ADB6D3E",
                  },
                  "" --region "$REGION" --subject "OpenHands EC2 Failed" --message "Instance: $INSTANCE_ID, Line: $1" || true; exit 1; }
trap 'error_handler $LINENO' ERR
retry() { for i in 1 2 3; do "$@" && return 0; sleep 10; done; return 1; }
retry dnf install -y docker
mkdir -p /etc/docker
echo '{"default-address-pools":[{"base":"172.17.0.0/12","size":24}],"log-driver":"json-file","log-opts":{"max-size":"100m","max-file":"3"}}' > /etc/docker/daemon.json
systemctl enable --now docker
usermod -aG docker ec2-user
chmod 666 /var/run/docker.sock
curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-Linux-aarch64" -o /usr/local/bin/docker-compose && chmod +x /usr/local/bin/docker-compose
retry dnf install -y amazon-cloudwatch-agent
echo '{"agent":{"metrics_collection_interval":60,"run_as_user":"root"},"metrics":{"namespace":"CWAgent","metrics_collected":{"cpu":{"measurement":["cpu_usage_idle","cpu_usage_user"],"metrics_collection_interval":60,"totalcpu":true},"mem":{"measurement":["mem_used_percent"],"metrics_collection_interval":60},"disk":{"measurement":["disk_used_percent"],"metrics_collection_interval":60,"resources":["/","/data"]}},"append_dimensions":{"AutoScalingGroupName":"\${aws:AutoScalingGroupName}","InstanceId":"\${aws:InstanceId}"}}}' > /opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json
/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -a fetch-config -m ec2 -s -c file:/opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.json
for i in {1..60}; do [ -e /dev/nvme1n1 ] && break; sleep 5; done; [ -e /dev/nvme1n1 ] || exit 1
blkid /dev/nvme1n1 || mkfs -t xfs /dev/nvme1n1
mkdir -p /data && mount /dev/nvme1n1 /data && echo "/dev/nvme1n1 /data xfs defaults,nofail 0 2" >> /etc/fstab
mkdir -p /data/openhands/{config,workspace,.openhands} && chown -R ec2-user:ec2-user /data/openhands
RUNTIME_VERSION=$(aws ssm get-parameter --name "",
                  {
                    "Ref": "RuntimeVersionParam2CECFC75",
                  },
                  "" --region $REGION --query "Parameter.Value" --output text 2>/dev/null || echo "1.2-nikolaik")
cat > /data/openhands/docker-compose.yml << EOF
services:
  openresty:
    image: ",
                  {
                    "Fn::Sub": "123456789012.dkr.ecr.us-west-2.\${AWS::URLSuffix}/cdk-hnb659fds-container-assets-123456789012-us-west-2:37c6a79b76ecf633887da106303243cb24b25e7e54642c5c9d515a453b98c02a",
                  },
                  "
    container_name: openresty-proxy
    restart: always
    ports:
      - "8080:8080"
    volumes:
      # SECURITY: Docker socket access required for container discovery (read-only)
      # OpenResty queries /containers/json to find sandbox container IPs for routing
      # Mitigations: mounted :ro, only GET requests, no container modifications
      - /var/run/docker.sock:/var/run/docker.sock:ro
    depends_on:
      - openhands
    logging:
      driver: json-file
      options:
        max-size: "100m"
        max-file: "3"

  openhands:
    image: ",
                  {
                    "Fn::Sub": "123456789012.dkr.ecr.us-west-2.\${AWS::URLSuffix}/cdk-hnb659fds-container-assets-123456789012-us-west-2:184a6347aaa1c2bbee93a7f0eafb1701f2bcbae0d299b3a5ac80e8dbcf45000b",
                  },
                  "
    container_name: openhands-app
    restart: unless-stopped
    environment:
      - SANDBOX_USER_ID=0
      - SANDBOX_RUNTIME_CONTAINER_IMAGE=docker.openhands.dev/openhands/runtime:$RUNTIME_VERSION
      - WORKSPACE_MOUNT_PATH=/data/openhands/workspace
      - LOG_ALL_EVENTS=true
      - HIDE_LLM_SETTINGS=true
      - USER_AUTH_CLASS=openhands.server.user_auth.cognito_user_auth.CognitoUserAuth
      - LLM_MODEL=bedrock/us.anthropic.claude-opus-4-5-20251101-v1:0
      - LLM_AWS_REGION_NAME=us-west-2
      - AWS_S3_BUCKET=",
                  {
                    "Fn::ImportValue": "TestMonitoringStack:ExportsOutputRefDataBucketE3889A50250F5285",
                  },
                  "
      - FILE_STORE=s3
      - FILE_STORE_PATH=",
                  {
                    "Fn::ImportValue": "TestMonitoringStack:ExportsOutputRefDataBucketE3889A50250F5285",
                  },
                  "
      - SANDBOX_DOCKER_RUNTIME_KWARGS={"extra_hosts":{"host.docker.internal":"host-gateway"}}
      - AGENT_SERVER_IMAGE_REPOSITORY=123456789012.dkr.ecr.us-west-2.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/cdk-hnb659fds-container-assets-123456789012-us-west-2
      - AGENT_SERVER_IMAGE_TAG=3a6444823da5ec080bdbc8786ec89ff48dbdd5c7af437ca401211f4b13ecc72c
      - AGENT_ENABLE_BROWSING=false
      - AGENT_ENABLE_MCP=false
      - SANDBOX_RUNTIME_STARTUP_ENV_VARS={"OH_PRELOAD_TOOLS":"false"}
      - DB_HOST=mock-proxy.proxy-abc123.us-west-2.rds.amazonaws.com
      - DB_PORT=5432
      - DB_NAME=openhands
      - DB_USER=openhands_proxy
      - DB_SSL=require
      - DB_CLUSTER_ENDPOINT=mock-cluster.cluster-abc123.us-west-2.rds.amazonaws.com
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /root/.docker:/root/.docker:ro
      - /data/openhands/.openhands:/root/.openhands
      - /data/openhands/workspace:/opt/workspace_base
      - /data/openhands/config/config.toml:/app/config.toml:ro
      - /data/openhands/config/database.env:/app/database.env:ro
    ports:
      - "3000:3000"
    env_file:
      - /data/openhands/config/database.env
    extra_hosts:
      - "host.docker.internal:host-gateway"

  watchtower:
    image: containrrr/watchtower:1.7.1
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_POLL_INTERVAL=86400
    command: openhands-app openresty-proxy
EOF

# Create config.toml (loaded from config/config.toml at CDK synth time)
cat > /data/openhands/config/config.toml << CONFIG
[core]
workspace_base = "/opt/workspace_base"
max_concurrent_conversations = 10
conversation_max_age_seconds = 15552000
default_agent = "CodeActAgent"
[llm]
model = "bedrock/global.anthropic.claude-opus-4-5-20251101-v1:0"
aws_region_name = "\${REGION}"
[sandbox]
timeout = 300
[agent]
enable_browsing = false
enable_mcp = false
[security]
confirmation_mode = false
security_analyzer = "llm"
CONFIG

cat > /usr/local/bin/setup-db-credentials.sh << 'DBSCRIPT'
#!/bin/bash
set -e
DB_HOST="mock-proxy.proxy-abc123.us-west-2.rds.amazonaws.com"
DB_PORT="5432"
DB_USER="openhands_proxy"
DB_NAME="openhands"
TOKEN=$(curl -s -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600")
REGION=$(curl -s -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/placement/region)
# Get password from Secrets Manager
SECRET_VALUE=$(aws secretsmanager get-secret-value --secret-id openhands/database/proxy-user --region "$REGION" --query SecretString --output text 2>/dev/null || echo "")
if [ -z "$SECRET_VALUE" ]; then echo "ERROR: Failed to retrieve database secret"; exit 1; fi
DB_PASS=$(echo "$SECRET_VALUE" | python3 -c "import sys,json; print(json.load(sys.stdin)['password'])")
ENCODED_PASS=$(python3 -c "import urllib.parse; print(urllib.parse.quote(\\"$DB_PASS\\", safe=\\"\\"))")
mkdir -p /data/openhands/config
echo "DB_HOST=$DB_HOST" > /data/openhands/config/database.env
echo "DB_PORT=$DB_PORT" >> /data/openhands/config/database.env
echo "DB_NAME=$DB_NAME" >> /data/openhands/config/database.env
echo "DB_USER=$DB_USER" >> /data/openhands/config/database.env
echo "DB_PASS=$DB_PASS" >> /data/openhands/config/database.env
echo "DB_SSL=require" >> /data/openhands/config/database.env
echo "DATABASE_URL=postgresql://\${DB_USER}:\${ENCODED_PASS}@\${DB_HOST}:\${DB_PORT}/\${DB_NAME}?sslmode=require" >> /data/openhands/config/database.env
chmod 600 /data/openhands/config/database.env
echo "Database credentials configured successfully"
DBSCRIPT
chmod +x /usr/local/bin/setup-db-credentials.sh
/usr/local/bin/setup-db-credentials.sh
cat > /etc/systemd/system/openhands.service << SERVICE
[Unit]
Description=OpenHands
After=docker.service
Requires=docker.service
[Service]
Type=simple
WorkingDirectory=/data/openhands
ExecStart=/usr/local/bin/docker-compose up
ExecStop=/usr/local/bin/docker-compose down
Restart=always
User=root
[Install]
WantedBy=multi-user.target
SERVICE
aws ecr get-login-password --region $REGION | docker login --username AWS --password-stdin ",
                  {
                    "Ref": "AWS::AccountId",
                  },
                  ".dkr.ecr.$REGION.amazonaws.com
pull_with_retry() { local img=$1; for i in 1 2 3; do docker pull "$img" && return 0; sleep 15; done; return 1; }
pull_with_retry "",
                  {
                    "Fn::Sub": "123456789012.dkr.ecr.us-west-2.\${AWS::URLSuffix}/cdk-hnb659fds-container-assets-123456789012-us-west-2:184a6347aaa1c2bbee93a7f0eafb1701f2bcbae0d299b3a5ac80e8dbcf45000b",
                  },
                  ""
pull_with_retry "",
                  {
                    "Fn::Sub": "123456789012.dkr.ecr.us-west-2.\${AWS::URLSuffix}/cdk-hnb659fds-container-assets-123456789012-us-west-2:37c6a79b76ecf633887da106303243cb24b25e7e54642c5c9d515a453b98c02a",
                  },
                  ""
pull_with_retry "docker.openhands.dev/openhands/runtime:$RUNTIME_VERSION"
pull_with_retry "",
                  {
                    "Fn::Sub": "123456789012.dkr.ecr.us-west-2.\${AWS::URLSuffix}/cdk-hnb659fds-container-assets-123456789012-us-west-2:3a6444823da5ec080bdbc8786ec89ff48dbdd5c7af437ca401211f4b13ecc72c",
                  },
                  ""
set +e; trap - ERR; pull_with_retry "containrrr/watchtower:1.7.1" || echo "Watchtower pull failed, auto-updates disabled"; set -e; trap 'error_handler $LINENO' ERR
systemctl daemon-reload && systemctl enable openhands && systemctl start openhands
for i in {1..30}; do docker inspect openresty-proxy >/dev/null 2>&1 && break; sleep 2; done
docker network connect bridge openresty-proxy 2>/dev/null || echo "Already connected to bridge network"
echo "OpenHands setup complete!"",
                ],
              ],
            },
          },
        },
        "TagSpecifications": [
          {
            "ResourceType": "launch-template",
            "Tags": [
              {
                "Key": "Name",
                "Value": "TestComputeStack/OpenHandsLaunchTemplate",
              },
            ],
          },
        ],
      },
      "Type": "AWS::EC2::LaunchTemplate",
    },
    "OpenHandsLaunchTemplateProfile0C9EFCAE": {
      "Properties": {
        "Roles": [
          {
            "Fn::ImportValue": "TestSecurityStack:ExportsOutputRefOpenHandsEc2RoleD46687489963EFBC",
          },
        ],
      },
      "Type": "AWS::IAM::InstanceProfile",
    },
    "OpenHandsTargetGroupB296B707": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/api/health",
        "HealthCheckTimeoutSeconds": 5,
        "HealthyThresholdCount": 2,
        "Port": 3000,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "30",
          },
          {
            "Key": "stickiness.enabled",
            "Value": "false",
          },
        ],
        "TargetType": "instance",
        "UnhealthyThresholdCount": 3,
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "OpenHandsVersionParam702B5340": {
      "Properties": {
        "Description": "OpenHands Docker image version tag",
        "Name": "/openhands/docker/openhands-version",
        "Tier": "Standard",
        "Type": "String",
        "Value": "1.2.1",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "OriginVerifyParam9FCB2131": {
      "Properties": {
        "Description": "Secret header value for CloudFront origin verification",
        "Name": "/openhands/cloudfront/origin-verify-secret",
        "Tier": "Standard",
        "Type": "String",
        "Value": {
          "Fn::Select": [
            2,
            {
              "Fn::Split": [
                "/",
                {
                  "Ref": "AWS::StackId",
                },
              ],
            },
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "RuntimeTargetGroup77A6315C": {
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckTimeoutSeconds": 5,
        "HealthyThresholdCount": 2,
        "Port": 8080,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "deregistration_delay.timeout_seconds",
            "Value": "30",
          },
          {
            "Key": "stickiness.enabled",
            "Value": "false",
          },
        ],
        "TargetType": "instance",
        "UnhealthyThresholdCount": 3,
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
    },
    "RuntimeVersionParam2CECFC75": {
      "Properties": {
        "Description": "OpenHands Runtime Docker image version tag",
        "Name": "/openhands/docker/runtime-version",
        "Tier": "Standard",
        "Type": "String",
        "Value": "1.2-nikolaik",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "SsmUsEast1SecretWriter39004BA6": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "SsmUsEast1SecretWriterCustomResourcePolicyC856BD77",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"SSM","action":"putParameter","parameters":{"Name":"/openhands/compute/origin-verify-secret","Value":"",
              {
                "Fn::Select": [
                  2,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Ref": "AWS::StackId",
                      },
                    ],
                  },
                ],
              },
              "","Type":"String","Overwrite":true,"Description":"Origin verification secret for CloudFront-to-ALB authentication"},"region":"us-east-1","physicalResourceId":{"id":"openhands-ssm-origin-secret"}}",
            ],
          ],
        },
        "Delete": "{"service":"SSM","action":"deleteParameter","parameters":{"Name":"/openhands/compute/origin-verify-secret"},"region":"us-east-1"}",
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"SSM","action":"putParameter","parameters":{"Name":"/openhands/compute/origin-verify-secret","Value":"",
              {
                "Fn::Select": [
                  2,
                  {
                    "Fn::Split": [
                      "/",
                      {
                        "Ref": "AWS::StackId",
                      },
                    ],
                  },
                ],
              },
              "","Type":"String","Overwrite":true,"Description":"Origin verification secret for CloudFront-to-ALB authentication"},"region":"us-east-1","physicalResourceId":{"id":"openhands-ssm-origin-secret"}}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "SsmUsEast1SecretWriterCustomResourcePolicyC856BD77": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssm:PutParameter",
                "ssm:DeleteParameter",
              ],
              "Effect": "Allow",
              "Resource": "arn:aws:ssm:us-east-1:123456789012:parameter/openhands/compute/*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SsmUsEast1SecretWriterCustomResourcePolicyC856BD77",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SsmUsEast1Writer67E457D2": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "SsmUsEast1WriterCustomResourcePolicy67DF62A1",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"SSM","action":"putParameter","parameters":{"Name":"/openhands/compute/alb-dns-name","Value":"",
              {
                "Fn::GetAtt": [
                  "OpenHandsAlb343FAEDA",
                  "DNSName",
                ],
              },
              "","Type":"String","Overwrite":true,"Description":"ALB DNS name for CloudFront origin"},"region":"us-east-1","physicalResourceId":{"id":"openhands-ssm-alb-dns"}}",
            ],
          ],
        },
        "Delete": "{"service":"SSM","action":"deleteParameter","parameters":{"Name":"/openhands/compute/alb-dns-name"},"region":"us-east-1"}",
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"SSM","action":"putParameter","parameters":{"Name":"/openhands/compute/alb-dns-name","Value":"",
              {
                "Fn::GetAtt": [
                  "OpenHandsAlb343FAEDA",
                  "DNSName",
                ],
              },
              "","Type":"String","Overwrite":true,"Description":"ALB DNS name for CloudFront origin"},"region":"us-east-1","physicalResourceId":{"id":"openhands-ssm-alb-dns"}}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "SsmUsEast1WriterCustomResourcePolicy67DF62A1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssm:PutParameter",
                "ssm:DeleteParameter",
              ],
              "Effect": "Allow",
              "Resource": "arn:aws:ssm:us-east-1:123456789012:parameter/openhands/compute/*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SsmUsEast1WriterCustomResourcePolicy67DF62A1",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`OpenHands Infrastructure Stacks EdgeStack matches snapshot 1`] = `
{
  "Mappings": {
    "AWSCloudFrontPartitionHostedZoneIdMap": {
      "aws": {
        "zoneId": "Z2FDTNDATAQYW2",
      },
      "aws-cn": {
        "zoneId": "Z3RFFRIM2A3IF5",
      },
    },
  },
  "Outputs": {
    "DistributionDomainName": {
      "Value": {
        "Fn::GetAtt": [
          "Distribution830FAC52",
          "DomainName",
        ],
      },
    },
    "SiteUrl": {
      "Value": "https://openhands.example.com",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueopenhandscomputealbdnsnameC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/openhands/compute/alb-dns-name",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValueopenhandscomputeoriginverifysecretC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/openhands/compute/origin-verify-secret",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AliasRecord851000D2": {
      "Properties": {
        "AliasTarget": {
          "DNSName": {
            "Fn::GetAtt": [
              "Distribution830FAC52",
              "DomainName",
            ],
          },
          "HostedZoneId": {
            "Fn::FindInMap": [
              "AWSCloudFrontPartitionHostedZoneIdMap",
              {
                "Ref": "AWS::Partition",
              },
              "zoneId",
            ],
          },
        },
        "HostedZoneId": "Z0123456789ABC",
        "Name": "openhands.example.com.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "AuthFunctionA1CD5E0F": {
      "DependsOn": [
        "AuthFunctionRole4D23EDCC",
      ],
      "Properties": {
        "Code": {
          "ZipFile": {
            "Fn::Join": [
              "",
              [
                "'use strict';

const https = require('https');
const crypto = require('crypto');

// Configuration - will be replaced at deploy time by CDK
const CONFIG = {
  userPoolId: '",
                {
                  "Fn::ImportValue": "TestAuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236",
                },
                "',
  clientId: '",
                {
                  "Fn::ImportValue": "TestAuthStack:ExportsOutputRefUserPoolWebAppClientCD2D5CB13BAB4F14",
                },
                "',
  clientSecret: '{{resolve:secretsmanager:openhands/cognito-client-secret-shared:SecretString}}',
  cognitoDomain: '",
                {
                  "Fn::ImportValue": "TestAuthStack:ExportsOutputRefUserPoolCognitoDomainD6C7F9FA874B93C7",
                },
                ".auth.us-east-1.amazoncognito.com',
  jwksUri: 'https://cognito-idp.us-east-1.amazonaws.com/",
                {
                  "Fn::ImportValue": "TestAuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236",
                },
                "/.well-known/jwks.json',
  issuer: 'https://cognito-idp.us-east-1.amazonaws.com/",
                {
                  "Fn::ImportValue": "TestAuthStack:ExportsOutputRefUserPool6BA7E5F296FD7236",
                },
                "',
  callbackPath: '/_callback',
  logoutPath: '/_logout',
  region: 'us-east-1',
  cookieDomain: '.example.com',
};

// JWKS cache (in-memory, persists across warm invocations)
let jwksCache = null;
let jwksCacheTime = 0;
const JWKS_CACHE_TTL = 3600000; // 1 hour

function base64UrlDecode(str) {
  str = str.replace(/-/g, '+').replace(/_/g, '/');
  while (str.length % 4) str += '=';
  return Buffer.from(str, 'base64').toString();
}

function base64UrlToBuffer(str) {
  str = str.replace(/-/g, '+').replace(/_/g, '/');
  while (str.length % 4) str += '=';
  return Buffer.from(str, 'base64');
}

// Fetch JWKS from Cognito
async function fetchJwks() {
  const now = Date.now();
  if (jwksCache && (now - jwksCacheTime) < JWKS_CACHE_TTL) {
    return jwksCache;
  }

  return new Promise((resolve, reject) => {
    https.get(CONFIG.jwksUri, (res) => {
      let data = '';
      res.on('data', chunk => data += chunk);
      res.on('end', () => {
        try {
          jwksCache = JSON.parse(data);
          jwksCacheTime = now;
          resolve(jwksCache);
        } catch (e) {
          reject(new Error('Failed to parse JWKS: ' + e.message));
        }
      });
    }).on('error', reject);
  });
}

// Find the correct key from JWKS
function findKey(jwks, kid) {
  return jwks.keys.find(key => key.kid === kid);
}

// Convert JWK to PEM format for verification
function jwkToPem(jwk) {
  if (jwk.kty !== 'RSA') {
    throw new Error('Unsupported key type: ' + jwk.kty);
  }

  const n = base64UrlToBuffer(jwk.n);
  const e = base64UrlToBuffer(jwk.e);

  // ASN.1 DER length encoding helper
  function encodeLength(len) {
    if (len < 128) {
      return Buffer.from([len]);
    } else if (len < 256) {
      return Buffer.from([0x81, len]);
    } else {
      return Buffer.from([0x82, (len >> 8) & 0xff, len & 0xff]);
    }
  }

  // Integer encoding helper
  function encodeInteger(buf) {
    // Add leading zero if high bit is set (to indicate positive number)
    if (buf[0] & 0x80) {
      buf = Buffer.concat([Buffer.from([0x00]), buf]);
    }
    return Buffer.concat([Buffer.from([0x02]), encodeLength(buf.length), buf]);
  }

  // Sequence encoding helper
  function encodeSequence(content) {
    return Buffer.concat([Buffer.from([0x30]), encodeLength(content.length), content]);
  }

  // BitString encoding helper (with proper length handling)
  function encodeBitString(content) {
    const len = content.length + 1; // +1 for unused bits byte
    return Buffer.concat([Buffer.from([0x03]), encodeLength(len), Buffer.from([0x00]), content]);
  }

  const nEncoded = encodeInteger(n);
  const eEncoded = encodeInteger(e);
  const rsaPublicKey = encodeSequence(Buffer.concat([nEncoded, eEncoded]));

  // RSA OID: 1.2.840.113549.1.1.1
  const rsaOid = Buffer.from([0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x01, 0x01, 0x05, 0x00]);
  const algorithmIdentifier = encodeSequence(rsaOid);

  // Wrap public key in BitString with proper length encoding
  const bitString = encodeBitString(rsaPublicKey);

  const publicKeyInfo = encodeSequence(Buffer.concat([algorithmIdentifier, bitString]));

  // Convert to PEM
  const base64 = publicKeyInfo.toString('base64');
  const lines = base64.match(/.{1,64}/g) || [];
  return '-----BEGIN PUBLIC KEY-----\\n' + lines.join('\\n') + '\\n-----END PUBLIC KEY-----';
}

// Verify JWT signature using JWKS
async function verifyTokenSignature(token) {
  try {
    const parts = token.split('.');
    if (parts.length !== 3) {
      console.error('Invalid token format');
      return null;
    }

    const [headerB64, payloadB64, signatureB64] = parts;
    const header = JSON.parse(base64UrlDecode(headerB64));
    const payload = JSON.parse(base64UrlDecode(payloadB64));

    // Verify algorithm
    if (header.alg !== 'RS256') {
      console.error('Unsupported algorithm:', header.alg);
      return null;
    }

    // Fetch JWKS and find the key
    const jwks = await fetchJwks();
    const key = findKey(jwks, header.kid);
    if (!key) {
      console.error('Key not found in JWKS:', header.kid);
      return null;
    }

    // Convert JWK to PEM
    const pem = jwkToPem(key);

    // Verify signature
    const signatureInput = headerB64 + '.' + payloadB64;
    const signature = base64UrlToBuffer(signatureB64);

    const verifier = crypto.createVerify('RSA-SHA256');
    verifier.update(signatureInput);

    if (!verifier.verify(pem, signature)) {
      console.error('Signature verification failed');
      return null;
    }

    // Verify issuer
    if (payload.iss !== CONFIG.issuer) {
      console.error('Invalid issuer:', payload.iss);
      return null;
    }

    // Verify expiration
    if (payload.exp && payload.exp < Date.now() / 1000) {
      console.error('Token expired');
      return null;
    }

    // Verify audience (for id_token) or client_id (for access_token)
    if (payload.aud !== CONFIG.clientId && payload.client_id !== CONFIG.clientId) {
      console.error('Invalid audience/client_id');
      return null;
    }

    // Verify token_use for id_token
    if (payload.token_use && payload.token_use !== 'id') {
      console.error('Invalid token_use:', payload.token_use);
      return null;
    }

    return payload;
  } catch (e) {
    console.error('Token verification error:', e);
    return null;
  }
}

/**
 * Get a single cookie value by name (returns first match)
 * @param {Array<{value: string}>|undefined} cookies - Cookie headers from CloudFront request
 * @param {string} name - Cookie name to find
 * @returns {string|null} Cookie value or null if not found
 */
function getCookie(cookies, name) {
  if (!cookies) return null;
  for (const cookie of cookies) {
    const match = cookie.value.match(new RegExp(\`\${name}=([^;]+)\`));
    if (match) return match[1];
  }
  return null;
}

/**
 * Get ALL cookies with the given name (handles multiple cookies from different User Pools/domains)
 * This is essential when users have stale cookies from old User Pools or different deployments.
 * @param {Array<{value: string}>|undefined} cookies - Cookie headers from CloudFront request
 * @param {string} name - Cookie name to find
 * @returns {string[]} Array of all cookie values with the given name
 */
function getAllCookies(cookies, name) {
  if (!cookies) return [];
  const results = [];
  const regex = new RegExp(\`\${name}=([^;]+)\`, 'g');
  for (const cookie of cookies) {
    let match;
    while ((match = regex.exec(cookie.value)) !== null) {
      results.push(match[1]);
    }
    regex.lastIndex = 0; // Reset regex state for next cookie header
  }
  return results;
}

function parseQueryString(qs) {
  if (!qs) return {};
  return qs.split('&').reduce((acc, pair) => {
    const [key, value] = pair.split('=');
    acc[decodeURIComponent(key)] = decodeURIComponent(value || '');
    return acc;
  }, {});
}

function buildLoginUrl(request) {
  const host = request.headers.host[0].value;
  const uri = request.uri;
  const querystring = request.querystring || '';
  const state = Buffer.from(JSON.stringify({ uri, querystring })).toString('base64url');

  return \`https://\${CONFIG.cognitoDomain}/login?response_type=code&client_id=\${CONFIG.clientId}&redirect_uri=https://\${host}\${CONFIG.callbackPath}&state=\${state}&scope=openid+email+profile\`;
}

async function exchangeCodeForTokens(code, redirectUri) {
  return new Promise((resolve, reject) => {
    const auth = Buffer.from(\`\${CONFIG.clientId}:\${CONFIG.clientSecret}\`).toString('base64');
    const postData = \`grant_type=authorization_code&code=\${code}&redirect_uri=\${encodeURIComponent(redirectUri)}&client_id=\${CONFIG.clientId}\`;

    const options = {
      hostname: CONFIG.cognitoDomain,
      port: 443,
      path: '/oauth2/token',
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'Authorization': \`Basic \${auth}\`,
        'Content-Length': Buffer.byteLength(postData),
      },
    };

    const req = https.request(options, (res) => {
      let data = '';
      res.on('data', chunk => data += chunk);
      res.on('end', () => {
        try {
          resolve(JSON.parse(data));
        } catch (e) {
          reject(new Error(\`Failed to parse token response: \${data}\`));
        }
      });
    });

    req.on('error', reject);
    req.write(postData);
    req.end();
  });
}

// Runtime subdomain parsing - {port}-{cid}.runtime.{subdomain}.{domain}
function parseRuntimeSubdomain(host) {
  // Match: {port}-{convId}.runtime.openhands.example.com
  const match = host.match(/^(\\d+)-([a-f0-9]{32})\\.runtime\\./);
  if (match) {
    return { port: match[1], convId: match[2], isRuntime: true };
  }
  return { isRuntime: false };
}

/**
 * Try to verify multiple tokens and return the first valid one
 * @param {string[]} tokens - Array of JWT tokens to try
 * @returns {Promise<{payload: object, index: number}|null>} Valid payload and index, or null
 */
async function tryVerifyTokens(tokens) {
  for (let i = 0; i < tokens.length; i++) {
    try {
      const payload = await verifyTokenSignature(tokens[i]);
      if (payload) {
        return { payload, index: i };
      }
    } catch (e) {
      console.log(\`Token \${i + 1}/\${tokens.length} verification failed:\`, e.message);
    }
  }
  return null;
}

exports.handler = async (event) => {
  const request = event.Records[0].cf.request;
  const uri = request.uri;
  const cookies = request.headers.cookie;
  const host = request.headers.host[0].value;

  // Check if this is a runtime subdomain request
  const runtime = parseRuntimeSubdomain(host);
  if (runtime.isRuntime) {
    // Rewrite URI to /runtime/{cid}/{port}/... format for ALB routing
    request.uri = '/runtime/' + runtime.convId + '/' + runtime.port + uri;

    // Defense-in-depth: Verify JWT and inject user header even for runtime requests
    // This ensures OpenResty receives verified user identity for authorization
    // Note: We don't redirect to login on failure - just don't inject the header
    // Try all id_token cookies (handles multiple cookies from different User Pools)
    const idTokens = getAllCookies(cookies, 'id_token');
    const result = await tryVerifyTokens(idTokens);
    if (result) {
      // Clear any existing headers to prevent spoofing
      delete request.headers['x-cognito-user-id'];
      // Inject verified user ID for downstream authorization
      request.headers['x-cognito-user-id'] = [{
        key: 'X-Cognito-User-Id',
        value: result.payload.sub
      }];
      console.log('Runtime request: verified user ' + result.payload.sub);
    } else if (idTokens.length > 0) {
      console.log('Runtime request: all ' + idTokens.length + ' tokens failed verification');
    }

    return request;
  }

  // Handle callback from Cognito
  if (uri === CONFIG.callbackPath) {
    try {
      const params = parseQueryString(request.querystring);
      const code = params.code;
      const state = params.state;

      if (!code) {
        console.error('No code in callback');
        return {
          status: '400',
          statusDescription: 'Bad Request',
          body: 'Missing authorization code',
        };
      }

      // Exchange code for tokens
      const redirectUri = \`https://\${host}\${CONFIG.callbackPath}\`;
      const tokens = await exchangeCodeForTokens(code, redirectUri);

      if (!tokens.id_token) {
        console.error('No id_token in response:', tokens);
        return {
          status: '500',
          statusDescription: 'Internal Server Error',
          body: 'Failed to get tokens',
        };
      }

      // Verify the id_token signature before setting cookie
      const payload = await verifyTokenSignature(tokens.id_token);
      if (!payload) {
        console.error('Token verification failed after exchange');
        return {
          status: '500',
          statusDescription: 'Internal Server Error',
          body: 'Token verification failed',
        };
      }

      // Decode state to get original destination
      let destination = '/';
      if (state) {
        try {
          const stateData = JSON.parse(Buffer.from(state, 'base64url').toString());
          destination = stateData.uri || '/';
          if (stateData.querystring) {
            destination += '?' + stateData.querystring;
          }
        } catch (e) {
          console.error('Failed to parse state:', e);
        }
      }

      // Calculate cookie expiry (1 day - matches id_token validity)
      const expiry = new Date(Date.now() + 86400000).toUTCString();

      return {
        status: '302',
        statusDescription: 'Found',
        headers: {
          location: [{ key: 'Location', value: destination }],
          'set-cookie': [
            { key: 'Set-Cookie', value: \`id_token=\${tokens.id_token}; Domain=\${CONFIG.cookieDomain}; Path=/; Expires=\${expiry}; HttpOnly; Secure; SameSite=Lax\` },
          ],
        },
      };
    } catch (e) {
      console.error('Callback error:', e);
      return {
        status: '500',
        statusDescription: 'Internal Server Error',
        body: 'Authentication failed: ' + e.message,
      };
    }
  }

  // Handle logout
  if (uri === CONFIG.logoutPath) {
    const logoutUrl = \`https://\${CONFIG.cognitoDomain}/logout?client_id=\${CONFIG.clientId}&logout_uri=https://\${host}/\`;
    return {
      status: '302',
      statusDescription: 'Found',
      headers: {
        location: [{ key: 'Location', value: logoutUrl }],
        'set-cookie': [{ key: 'Set-Cookie', value: \`id_token=; Domain=\${CONFIG.cookieDomain}; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; HttpOnly; Secure\` }],
      },
    };
  }

  // Check for valid token with full JWKS signature verification
  // Try all id_token cookies (handles multiple cookies from different User Pools/domains)
  const idTokens = getAllCookies(cookies, 'id_token');
  const result = await tryVerifyTokens(idTokens);
  if (result) {
    // Token is valid (signature verified)
    // Clear any existing x-cognito-* headers to prevent spoofing
    delete request.headers['x-cognito-user-id'];
    delete request.headers['x-cognito-email'];
    delete request.headers['x-cognito-email-verified'];

    // Inject verified user information as headers for downstream services
    request.headers['x-cognito-user-id'] = [{
      key: 'X-Cognito-User-Id',
      value: result.payload.sub
    }];
    request.headers['x-cognito-email'] = [{
      key: 'X-Cognito-Email',
      value: result.payload.email || ''
    }];
    request.headers['x-cognito-email-verified'] = [{
      key: 'X-Cognito-Email-Verified',
      value: String(result.payload.email_verified || false)
    }];

    console.log('Authenticated user ' + result.payload.sub + ' (tried ' + (result.index + 1) + '/' + idTokens.length + ' tokens)');
    return request;
  }

  if (idTokens.length > 0) {
    console.log('All ' + idTokens.length + ' id_token cookies failed verification, redirecting to login');
  }

  // No valid token, redirect to login
  return {
    status: '302',
    statusDescription: 'Found',
    headers: {
      location: [{ key: 'Location', value: buildLoginUrl(request) }],
    },
  };
};

",
              ],
            ],
          },
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "Role": {
          "Fn::GetAtt": [
            "AuthFunctionRole4D23EDCC",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 5,
      },
      "Type": "AWS::Lambda::Function",
    },
    "AuthFunctionCurrentVersionDB17CE86d156ee4ec6a3c0c526b534c66ac82140": {
      "Metadata": {
        "aws:cdk:do-not-refactor": true,
      },
      "Properties": {
        "FunctionName": {
          "Ref": "AuthFunctionA1CD5E0F",
        },
      },
      "Type": "AWS::Lambda::Version",
    },
    "AuthFunctionRole4D23EDCC": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "edgelambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "Certificate4E7ABB08": {
      "Properties": {
        "DomainName": "openhands.example.com",
        "DomainValidationOptions": [
          {
            "DomainName": "openhands.example.com",
            "HostedZoneId": "Z0123456789ABC",
          },
          {
            "DomainName": "*.runtime.openhands.example.com",
            "HostedZoneId": "Z0123456789ABC",
          },
        ],
        "SubjectAlternativeNames": [
          "*.runtime.openhands.example.com",
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "TestEdgeStack/Certificate",
          },
        ],
        "ValidationMethod": "DNS",
      },
      "Type": "AWS::CertificateManager::Certificate",
    },
    "CorsHeadersPolicy085CC81B": {
      "Properties": {
        "ResponseHeadersPolicyConfig": {
          "Comment": "Adds CORS headers for credentialed requests",
          "CorsConfig": {
            "AccessControlAllowCredentials": true,
            "AccessControlAllowHeaders": {
              "Items": [
                "Accept",
                "Accept-Language",
                "Content-Language",
                "Content-Type",
                "Authorization",
                "Cache-Control",
                "Pragma",
                "Origin",
                "X-Requested-With",
              ],
            },
            "AccessControlAllowMethods": {
              "Items": [
                "GET",
                "HEAD",
                "OPTIONS",
                "PUT",
                "PATCH",
                "POST",
                "DELETE",
              ],
            },
            "AccessControlAllowOrigins": {
              "Items": [
                "https://openhands.example.com",
              ],
            },
            "AccessControlExposeHeaders": {
              "Items": [
                "Content-Length",
                "Content-Type",
                "ETag",
                "Cache-Control",
              ],
            },
            "AccessControlMaxAgeSec": 86400,
            "OriginOverride": true,
          },
          "Name": "OpenHands-CORS-example-com-123456789012",
        },
      },
      "Type": "AWS::CloudFront::ResponseHeadersPolicy",
    },
    "Distribution830FAC52": {
      "Properties": {
        "DistributionConfig": {
          "Aliases": [
            "openhands.example.com",
            "*.runtime.openhands.example.com",
          ],
          "Comment": "OpenHands CloudFront Distribution",
          "DefaultCacheBehavior": {
            "AllowedMethods": [
              "GET",
              "HEAD",
              "OPTIONS",
              "PUT",
              "PATCH",
              "POST",
              "DELETE",
            ],
            "CachePolicyId": "4135ea2d-6df8-44a3-9df3-4b5a84be39ad",
            "Compress": true,
            "LambdaFunctionAssociations": [
              {
                "EventType": "viewer-request",
                "LambdaFunctionARN": {
                  "Ref": "AuthFunctionCurrentVersionDB17CE86d156ee4ec6a3c0c526b534c66ac82140",
                },
              },
              {
                "EventType": "origin-response",
                "LambdaFunctionARN": {
                  "Ref": "SecurityHeadersFunctionCurrentVersion1FC2948E070e97089821193f02cd7e9b4063582b",
                },
              },
            ],
            "OriginRequestPolicyId": "216adef6-5c7f-47e4-b989-5492eafa07d3",
            "ResponseHeadersPolicyId": {
              "Ref": "CorsHeadersPolicy085CC81B",
            },
            "TargetOriginId": "TestEdgeStackDistributionOrigin18490990F",
            "ViewerProtocolPolicy": "redirect-to-https",
          },
          "Enabled": true,
          "HttpVersion": "http2and3",
          "IPV6Enabled": true,
          "Origins": [
            {
              "CustomOriginConfig": {
                "OriginKeepaliveTimeout": 60,
                "OriginProtocolPolicy": "http-only",
                "OriginReadTimeout": 60,
                "OriginSSLProtocols": [
                  "TLSv1.2",
                ],
              },
              "DomainName": {
                "Ref": "SsmParameterValueopenhandscomputealbdnsnameC96584B6F00A464EAD1953AFF4B05118Parameter",
              },
              "Id": "TestEdgeStackDistributionOrigin18490990F",
              "OriginCustomHeaders": [
                {
                  "HeaderName": "X-Origin-Verify",
                  "HeaderValue": {
                    "Ref": "SsmParameterValueopenhandscomputeoriginverifysecretC96584B6F00A464EAD1953AFF4B05118Parameter",
                  },
                },
              ],
            },
          ],
          "PriceClass": "PriceClass_100",
          "ViewerCertificate": {
            "AcmCertificateArn": {
              "Ref": "Certificate4E7ABB08",
            },
            "MinimumProtocolVersion": "TLSv1.2_2021",
            "SslSupportMethod": "sni-only",
          },
          "WebACLId": {
            "Fn::GetAtt": [
              "WebAcl",
              "Arn",
            ],
          },
        },
      },
      "Type": "AWS::CloudFront::Distribution",
    },
    "RuntimeWildcardRecord40ECEBBE": {
      "Properties": {
        "AliasTarget": {
          "DNSName": {
            "Fn::GetAtt": [
              "Distribution830FAC52",
              "DomainName",
            ],
          },
          "HostedZoneId": {
            "Fn::FindInMap": [
              "AWSCloudFrontPartitionHostedZoneIdMap",
              {
                "Ref": "AWS::Partition",
              },
              "zoneId",
            ],
          },
        },
        "HostedZoneId": "Z0123456789ABC",
        "Name": "*.runtime.openhands.example.com.",
        "Type": "A",
      },
      "Type": "AWS::Route53::RecordSet",
    },
    "SecurityHeadersFunction224E3783": {
      "DependsOn": [
        "SecurityHeadersFunctionRoleA2DFD644",
      ],
      "Properties": {
        "Code": {
          "ZipFile": "
// Origin Response Handler - adds security headers for runtime requests
exports.handler = async (event) => {
  const response = event.Records[0].cf.response;
  const request = event.Records[0].cf.request;
  const host = request.headers.host ? request.headers.host[0].value : '';

  // Check if this is a runtime request (runtime subdomain)
  if (host.includes('.runtime.')) {
    const headers = response.headers;

    // Security headers - protect against cross-runtime attacks
    headers['x-frame-options'] = [{ key: 'X-Frame-Options', value: 'SAMEORIGIN' }];
    headers['x-content-type-options'] = [{ key: 'X-Content-Type-Options', value: 'nosniff' }];
    headers['x-xss-protection'] = [{ key: 'X-XSS-Protection', value: '1; mode=block' }];
    headers['referrer-policy'] = [{ key: 'Referrer-Policy', value: 'strict-origin-when-cross-origin' }];
    headers['content-security-policy'] = [{
      key: 'Content-Security-Policy',
      value: "frame-ancestors 'self'; default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:;"
    }];

    // Cookie security - rewrite Set-Cookie headers for isolation
    if (headers['set-cookie']) {
      headers['set-cookie'] = headers['set-cookie'].map(cookie => {
        let value = cookie.value;
        // Remove any Domain attribute (ensures cookie only valid for exact host)
        value = value.replace(/;\\s*Domain=[^;]*/gi, '');
        // Add Secure attribute if not present
        if (!/;\\s*Secure/i.test(value)) {
          value += '; Secure';
        }
        // Add SameSite=Strict if not present
        if (!/;\\s*SameSite/i.test(value)) {
          value += '; SameSite=Strict';
        }
        return { key: 'Set-Cookie', value };
      });
    }
  }

  return response;
};
",
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "Role": {
          "Fn::GetAtt": [
            "SecurityHeadersFunctionRoleA2DFD644",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 5,
      },
      "Type": "AWS::Lambda::Function",
    },
    "SecurityHeadersFunctionCurrentVersion1FC2948E070e97089821193f02cd7e9b4063582b": {
      "Metadata": {
        "aws:cdk:do-not-refactor": true,
      },
      "Properties": {
        "FunctionName": {
          "Ref": "SecurityHeadersFunction224E3783",
        },
      },
      "Type": "AWS::Lambda::Version",
    },
    "SecurityHeadersFunctionRoleA2DFD644": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "edgelambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "WebAcl": {
      "Properties": {
        "DefaultAction": {
          "Allow": {},
        },
        "Rules": [
          {
            "Name": "AWSManagedRulesCommonRuleSet",
            "OverrideAction": {
              "None": {},
            },
            "Priority": 1,
            "Statement": {
              "ManagedRuleGroupStatement": {
                "Name": "AWSManagedRulesCommonRuleSet",
                "RuleActionOverrides": [
                  {
                    "ActionToUse": {
                      "Count": {},
                    },
                    "Name": "SizeRestrictions_BODY",
                  },
                ],
                "VendorName": "AWS",
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "AWSManagedRulesCommonRuleSet",
              "SampledRequestsEnabled": true,
            },
          },
          {
            "Name": "AWSManagedRulesKnownBadInputsRuleSet",
            "OverrideAction": {
              "None": {},
            },
            "Priority": 2,
            "Statement": {
              "ManagedRuleGroupStatement": {
                "Name": "AWSManagedRulesKnownBadInputsRuleSet",
                "VendorName": "AWS",
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "AWSManagedRulesKnownBadInputsRuleSet",
              "SampledRequestsEnabled": true,
            },
          },
          {
            "Action": {
              "Block": {},
            },
            "Name": "RateLimitRule",
            "Priority": 3,
            "Statement": {
              "RateBasedStatement": {
                "AggregateKeyType": "IP",
                "Limit": 50000,
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "RateLimitRule",
              "SampledRequestsEnabled": true,
            },
          },
        ],
        "Scope": "CLOUDFRONT",
        "VisibilityConfig": {
          "CloudWatchMetricsEnabled": true,
          "MetricName": "OpenHandsWebAcl",
          "SampledRequestsEnabled": true,
        },
      },
      "Type": "AWS::WAFv2::WebACL",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`OpenHands Infrastructure Stacks MonitoringStack matches snapshot 1`] = `
{
  "Outputs": {
    "AlertTopicArn": {
      "Description": "SNS Alert Topic ARN",
      "Value": {
        "Ref": "AlertTopic2720D535",
      },
    },
    "DashboardUrl": {
      "Description": "CloudWatch Dashboard URL",
      "Value": "https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#dashboards:name=OpenHands-Monitoring",
    },
    "DataBucketName": {
      "Description": "S3 Bucket for OpenHands data persistence",
      "Value": {
        "Ref": "DataBucketE3889A50",
      },
    },
    "LogGroupName": {
      "Description": "CloudWatch Log Group Name",
      "Value": {
        "Ref": "AppLogGroup7D8CD952",
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AlertTopic2720D535": {
      "Properties": {
        "DisplayName": "OpenHands Alerts",
      },
      "Type": "AWS::SNS::Topic",
    },
    "AppLogGroup7D8CD952": {
      "DeletionPolicy": "Retain",
      "Properties": {
        "LogGroupName": "/openhands/application",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "DataBucketE3889A50": {
      "DeletionPolicy": "Retain",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "LifecycleConfiguration": {
          "Rules": [
            {
              "AbortIncompleteMultipartUpload": {
                "DaysAfterInitiation": 7,
              },
              "Id": "CleanupOldVersions",
              "NoncurrentVersionExpiration": {
                "NoncurrentDays": 30,
              },
              "Status": "Enabled",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "DataBucketPolicy3231C704": {
      "Properties": {
        "Bucket": {
          "Ref": "DataBucketE3889A50",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "DataBucketE3889A50",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "DataBucketE3889A50",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "OpenHandsBackupPlan21FAD152": {
      "Properties": {
        "BackupPlan": {
          "BackupPlanName": "OpenHands-Daily-Backup",
          "BackupPlanRule": [
            {
              "CompletionWindowMinutes": 120,
              "Lifecycle": {
                "DeleteAfterDays": 14,
              },
              "RuleName": "DailyBackup",
              "ScheduleExpression": "cron(0 3 * * ? *)",
              "StartWindowMinutes": 60,
              "TargetBackupVault": {
                "Fn::GetAtt": [
                  "OpenHandsBackupPlanVaultC4597176",
                  "BackupVaultName",
                ],
              },
            },
          ],
        },
      },
      "Type": "AWS::Backup::BackupPlan",
    },
    "OpenHandsBackupPlanOpenHandsBackupSelectionCAB97D14": {
      "Properties": {
        "BackupPlanId": {
          "Fn::GetAtt": [
            "OpenHandsBackupPlan21FAD152",
            "BackupPlanId",
          ],
        },
        "BackupSelection": {
          "IamRoleArn": {
            "Fn::GetAtt": [
              "OpenHandsBackupPlanOpenHandsBackupSelectionRole7901107E",
              "Arn",
            ],
          },
          "ListOfTags": [
            {
              "ConditionKey": "backup",
              "ConditionType": "STRINGEQUALS",
              "ConditionValue": "true",
            },
          ],
          "SelectionName": "OpenHands-EBS-Selection",
        },
      },
      "Type": "AWS::Backup::BackupSelection",
    },
    "OpenHandsBackupPlanOpenHandsBackupSelectionRole7901107E": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "backup.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSBackupServiceRolePolicyForBackup",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "OpenHandsBackupPlanVaultC4597176": {
      "DeletionPolicy": "Retain",
      "Properties": {
        "BackupVaultName": "estMonitoringStackOpenHandsBackupPlanVault7B35F892",
      },
      "Type": "AWS::Backup::BackupVault",
      "UpdateReplacePolicy": "Retain",
    },
    "OpenHandsDashboardE5483B9E": {
      "Properties": {
        "DashboardBody": "{"widgets":[{"type":"text","width":24,"height":2,"x":0,"y":0,"properties":{"markdown":"# OpenHands Monitoring Dashboard\\n\\nASG-specific alarms are managed by the Compute stack."}}]}",
        "DashboardName": "OpenHands-Monitoring",
      },
      "Type": "AWS::CloudWatch::Dashboard",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`OpenHands Infrastructure Stacks NetworkStack matches snapshot 1`] = `
{
  "Outputs": {
    "VpcId": {
      "Description": "VPC ID",
      "Value": "vpc-12345",
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "BedrockRuntimeEndpointD9440E01": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "VpcEndpointSg00AAF2D5",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-west-2.bedrock-runtime",
        "SubnetIds": [
          "p-12345",
          "p-67890",
        ],
        "VpcEndpointType": "Interface",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "CloudWatchLogsEndpointF23EDC4F": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "VpcEndpointSg00AAF2D5",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-west-2.logs",
        "SubnetIds": [
          "p-12345",
          "p-67890",
        ],
        "VpcEndpointType": "Interface",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "Ec2MessagesEndpoint440704A5": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "VpcEndpointSg00AAF2D5",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-west-2.ec2messages",
        "SubnetIds": [
          "p-12345",
          "p-67890",
        ],
        "VpcEndpointType": "Interface",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "EcrApiEndpointB01DFFD7": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "VpcEndpointSg00AAF2D5",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-west-2.ecr.api",
        "SubnetIds": [
          "p-12345",
          "p-67890",
        ],
        "VpcEndpointType": "Interface",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "EcrDkrEndpoint2A32680E": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "VpcEndpointSg00AAF2D5",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-west-2.ecr.dkr",
        "SubnetIds": [
          "p-12345",
          "p-67890",
        ],
        "VpcEndpointType": "Interface",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "S3EndpointD570F362": {
      "Properties": {
        "RouteTableIds": [
          "rtb-12345p",
          "rtb-57890p",
          "rtb-12345s",
          "rtb-67890s",
        ],
        "ServiceName": {
          "Fn::Join": [
            "",
            [
              "com.amazonaws.",
              {
                "Ref": "AWS::Region",
              },
              ".s3",
            ],
          ],
        },
        "VpcEndpointType": "Gateway",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SecretsManagerEndpoint5E83C66B": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "VpcEndpointSg00AAF2D5",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-west-2.secretsmanager",
        "SubnetIds": [
          "p-12345",
          "p-67890",
        ],
        "VpcEndpointType": "Interface",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SsmEndpoint986CF28C": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "VpcEndpointSg00AAF2D5",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-west-2.ssm",
        "SubnetIds": [
          "p-12345",
          "p-67890",
        ],
        "VpcEndpointType": "Interface",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SsmMessagesEndpoint3405F98B": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "VpcEndpointSg00AAF2D5",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-west-2.ssmmessages",
        "SubnetIds": [
          "p-12345",
          "p-67890",
        ],
        "VpcEndpointType": "Interface",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "VpcEndpointSg00AAF2D5": {
      "Properties": {
        "GroupDescription": "Security group for VPC Endpoints",
        "SecurityGroupEgress": [
          {
            "CidrIp": "255.255.255.255/32",
            "Description": "Disallow all traffic",
            "FromPort": 252,
            "IpProtocol": "icmp",
            "ToPort": 86,
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": "1.2.3.4/5",
            "Description": "Allow HTTPS from VPC",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`OpenHands Infrastructure Stacks SecurityStack matches snapshot 1`] = `
{
  "Outputs": {
    "Ec2RoleArn": {
      "Description": "EC2 Instance Role ARN",
      "Value": {
        "Fn::GetAtt": [
          "OpenHandsEc2RoleD4668748",
          "Arn",
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AlbSecurityGroup86A59E99": {
      "Properties": {
        "GroupDescription": "Security group for Application Load Balancer",
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "AlbSecurityGroupfrompl82a045eb80AFE76D69": {
      "Properties": {
        "Description": "Allow HTTP from CloudFront",
        "FromPort": 80,
        "GroupId": {
          "Fn::GetAtt": [
            "AlbSecurityGroup86A59E99",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourcePrefixListId": "pl-82a045eb",
        "ToPort": 80,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "AlbSecurityGrouptoTestSecurityStackEc2SecurityGroup55A42D313000C2D6BB59": {
      "Properties": {
        "Description": "Allow traffic to OpenHands app",
        "DestinationSecurityGroupId": {
          "Fn::GetAtt": [
            "Ec2SecurityGroup55889913",
            "GroupId",
          ],
        },
        "FromPort": 3000,
        "GroupId": {
          "Fn::GetAtt": [
            "AlbSecurityGroup86A59E99",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 3000,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "AlbSecurityGrouptoTestSecurityStackEc2SecurityGroup55A42D318080E731A33C": {
      "Properties": {
        "Description": "Allow traffic to nginx runtime proxy",
        "DestinationSecurityGroupId": {
          "Fn::GetAtt": [
            "Ec2SecurityGroup55889913",
            "GroupId",
          ],
        },
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "AlbSecurityGroup86A59E99",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "Ec2SecurityGroup55889913": {
      "Properties": {
        "GroupDescription": "Security group for OpenHands EC2 instances",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow HTTPS outbound for Docker registry",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "VpcId": "vpc-12345",
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "Ec2SecurityGroupfromTestSecurityStackAlbSecurityGroupF68B86B13000E689486E": {
      "Properties": {
        "Description": "Allow traffic from ALB to OpenHands app",
        "FromPort": 3000,
        "GroupId": {
          "Fn::GetAtt": [
            "Ec2SecurityGroup55889913",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "AlbSecurityGroup86A59E99",
            "GroupId",
          ],
        },
        "ToPort": 3000,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "Ec2SecurityGroupfromTestSecurityStackAlbSecurityGroupF68B86B18080E114F9D4": {
      "Properties": {
        "Description": "Allow traffic from ALB to nginx runtime proxy",
        "FromPort": 8080,
        "GroupId": {
          "Fn::GetAtt": [
            "Ec2SecurityGroup55889913",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "AlbSecurityGroup86A59E99",
            "GroupId",
          ],
        },
        "ToPort": 8080,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "Ec2SecurityGrouptoTestNetworkStackVpcEndpointSg4E3FE0954430713D399": {
      "Properties": {
        "Description": "Allow HTTPS to VPC Endpoints",
        "DestinationSecurityGroupId": {
          "Fn::ImportValue": "TestNetworkStack:ExportsOutputFnGetAttVpcEndpointSg00AAF2D5GroupId9FB5E70F",
        },
        "FromPort": 443,
        "GroupId": {
          "Fn::GetAtt": [
            "Ec2SecurityGroup55889913",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 443,
      },
      "Type": "AWS::EC2::SecurityGroupEgress",
    },
    "OpenHandsEc2RoleD4668748": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ec2.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Description": "IAM role for OpenHands EC2 instances",
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/AmazonSSMManagedInstanceCore",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/CloudWatchAgentServerPolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "OpenHandsEc2RoleDefaultPolicy0D07380E": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "bedrock:InvokeModel",
                "bedrock:InvokeModelWithResponseStream",
              ],
              "Effect": "Allow",
              "Resource": [
                "arn:aws:bedrock:*::foundation-model/anthropic.claude-*",
                "arn:aws:bedrock:*::foundation-model/us.anthropic.claude-*",
                "arn:aws:bedrock:us-west-2:123456789012:inference-profile/*anthropic.claude*",
                "arn:aws:bedrock:*:123456789012:inference-profile/global.anthropic.claude*",
              ],
              "Sid": "BedrockAccess",
            },
            {
              "Action": "secretsmanager:GetSecretValue",
              "Effect": "Allow",
              "Resource": "arn:aws:secretsmanager:us-west-2:123456789012:secret:openhands/*",
              "Sid": "SecretsManagerAccess",
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
              "Sid": "EcrAuthorizationToken",
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
              ],
              "Effect": "Allow",
              "Resource": "arn:aws:logs:us-west-2:123456789012:log-group:/openhands/*",
              "Sid": "CloudWatchLogsAccess",
            },
            {
              "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:ListBucket",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::ImportValue": "TestMonitoringStack:ExportsOutputFnGetAttDataBucketE3889A50Arn98F8399F",
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::ImportValue": "TestMonitoringStack:ExportsOutputFnGetAttDataBucketE3889A50Arn98F8399F",
                      },
                      "/*",
                    ],
                  ],
                },
              ],
              "Sid": "S3DataBucketAccess",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "OpenHandsEc2RoleDefaultPolicy0D07380E",
        "Roles": [
          {
            "Ref": "OpenHandsEc2RoleD4668748",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "OpenHandsInstanceProfile": {
      "Properties": {
        "Roles": [
          {
            "Ref": "OpenHandsEc2RoleD4668748",
          },
        ],
      },
      "Type": "AWS::IAM::InstanceProfile",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;
