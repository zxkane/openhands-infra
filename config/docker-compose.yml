version: '3.8'

services:
  openhands:
    image: 845861764576.dkr.ecr.us-west-2.amazonaws.com/openhands-custom:latest
    container_name: openhands-app
    restart: unless-stopped
    environment:
      - SANDBOX_RUNTIME_CONTAINER_IMAGE=docker.openhands.dev/openhands/runtime:latest-nikolaik
      - WORKSPACE_MOUNT_PATH=/data/openhands/workspace
      - LOG_ALL_EVENTS=true
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /data/openhands/.openhands:/.openhands
      - /data/openhands/workspace:/opt/workspace_base
      - /data/openhands/config/config.toml:/app/config.toml:ro
    ports:
      - "127.0.0.1:3000:3000"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    logging:
      driver: awslogs
      options:
        awslogs-region: ${AWS_REGION}
        awslogs-group: /openhands/application
        awslogs-stream-prefix: openhands
        awslogs-create-group: "true"

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_POLL_INTERVAL=86400
      - WATCHTOWER_INCLUDE_RESTARTING=true
    command: openhands-app
